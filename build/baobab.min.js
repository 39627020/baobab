/* baobab.js - Version: 2.0.0-rc1 - Author: Yomguithereal (Guillaume Plique) */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Baobab=t()}}(function(){var t;return function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){var r=t[a][1][e];return i(r?r:e)},l,l.exports,e,t,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,r,n){(function(){"use strict";function e(t,e){var r,n={};for(r in t)n[r]=t[r];for(r in e)n[r]=e[r];return n}function i(t){return t&&"object"==typeof t&&!Array.isArray(t)&&!(t instanceof Function)&&!(t instanceof RegExp)}function o(t,e,r){var n,i,o,a;for(i in t)e.call(r||null,i,t[i]);if(Object.getOwnPropertySymbols)for(n=Object.getOwnPropertySymbols(t),o=0,a=n.length;a>o;o++)e.call(r||null,n[o],t[n[o]])}function a(t,e){t=t||[];var r,n,i=[];for(n=0,r=t.length;r>n;n++)t[n].fn!==e&&i.push(t[n]);return i}var s={once:"boolean",scope:"object"},u=0,h=function(){this._enabled=!0,this.unbindAll()};h.prototype.unbindAll=function(){return this._handlers={},this._handlersAll=[],this._handlersComplex=[],this},h.prototype.on=function(t,e,r){var n,a,h,l,f,c,p;if(i(t))return o(t,function(t,r){this.on(t,r,e)},this),this;for("function"==typeof t&&(r=e,e=t,t=null),f=[].concat(t),n=0,a=f.length;a>n;n++){if(l=f[n],p={order:u++,fn:e},"string"==typeof l||"symbol"==typeof l)this._handlers[l]||(this._handlers[l]=[]),c=this._handlers[l],p.type=l;else if(l instanceof RegExp)c=this._handlersComplex,p.pattern=l;else{if(null!==l)throw Error("Emitter.on: invalid event.");c=this._handlersAll}for(h in r||{})s[h]&&(p[h]=r[h]);c.push(p)}return this},h.prototype.once=function(){var t=Array.prototype.slice.call(arguments),r=t.length-1;return i(t[r])&&t.length>1?t[r]=e(t[r],{once:!0}):t.push({once:!0}),this.on.apply(this,t)},h.prototype.off=function(t,e){var r,n,s,u;if(1===arguments.length&&"function"==typeof t){e=arguments[0];for(s in this._handlers)this._handlers[s]=a(this._handlers[s],e),0===this._handlers[s].length&&delete this._handlers[s];this._handlersAll=a(this._handlersAll,e),this._handlersComplex=a(this._handlersComplex,e)}else if(1!==arguments.length||"string"!=typeof t&&"symbol"!=typeof t)if(2===arguments.length){var h=[].concat(t);for(r=0,n=h.length;n>r;r++)u=h[r],this._handlers[u]=a(this._handlers[u],e),0===(this._handlers[u]||[]).length&&delete this._handlers[u]}else i(t)&&o(t,this.off,this);else delete this._handlers[t];return this},h.prototype.listeners=function(t){var e,r,n,i=this._handlersAll||[],o=!1;if(!t)throw Error("Emitter.listeners: no event provided.");for(i=i.concat(this._handlers[t]||[]),r=0,n=this._handlersComplex.length;n>r;r++)e=this._handlersComplex[r],~t.search(e.pattern)&&(o=!0,i.push(e));return this._handlersAll.length||o?i.sort(function(t,e){return t.order-e.order}):i.slice(0)},h.prototype.emit=function(t,e){if(!this._enabled)return this;if(i(t))return o(t,this.emit,this),this;var r,n,a,s,u,h,l,f,c=[].concat(t),p=[];for(u=0,l=c.length;l>u;u++){for(a=this.listeners(c[u]),h=0,f=a.length;f>h;h++)s=a[h],r={type:c[u],target:this},arguments.length>1&&(r.data=e),s.fn.call("scope"in s?s.scope:this,r),s.once&&p.push(s);for(h=p.length-1;h>=0;h--)n=p[h].type?this._handlers[p[h].type]:p[h].pattern?this._handlersComplex:this._handlersAll,n.splice(n.indexOf(p[h]),1)}return this},h.prototype.kill=function(){this.unbindAll(),this._handlers=null,this._handlersAll=null,this._handlersComplex=null,this._enabled=!1,this.unbindAll=this.on=this.once=this.off=this.emit=this.listeners=Function.prototype},h.prototype.disable=function(){return this._enabled=!1,this},h.prototype.enable=function(){return this._enabled=!0,this},h.version="3.1.1","undefined"!=typeof n?("undefined"!=typeof r&&r.exports&&(n=r.exports=h),n.Emitter=h):"function"==typeof t&&t.amd?t("emmett",[],function(){return h}):this.Emitter=h}).call(this)},{}],2:[function(t,e,r){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e["default"]=t,e}function i(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t){return"/"+t.map(function(t){return g["default"]["function"](t)||g["default"].object(t)?"#"+B()+"#":t}).join("/")}r.__esModule=!0;var u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},h=t("emmett"),l=i(h),f=t("./cursor"),c=i(f),p=t("./monkey"),d=t("./watcher"),y=i(d),v=t("./type"),g=i(v),m=t("./update"),b=i(m),_=t("./helpers"),w=n(_),P=w.arrayFrom,k=w.coercePath,j=w.deepFreeze,O=w.getIn,E=w.makeError,x=w.deepMerge,C=w.pathObject,M=w.shallowMerge,B=w.uniqid,A={autoCommit:!0,asynchronous:!0,immutable:!0,persistent:!0,pure:!0,validate:null,validationBehavior:"rollback"},D=function(t){function e(r,n){var i=this;if(o(this,e),t.call(this),arguments.length<1&&(r={}),!g["default"].object(r)&&!g["default"].array(r))throw E("Baobab: invalid data.",{data:r});this.options=M({},A,n),this.options.persistent||(this.options.immutable=!1,this.options.pure=!1),this._identity="[object Baobab]",this._cursors={},this._future=null,this._transaction=[],this._affectedPathsIndex={},this._monkeys={},this._previousData=null,this._data=r,this.root=this.select(),this.options.immutable&&j(this._data);var a=function(t){i[t]=function(){var e=this.root[t].apply(this.root,arguments);return e instanceof c["default"]?this:e}};["apply","concat","exists","get","push","merge","project","serialize","set","splice","unset","unshift"].forEach(a),this._refreshMonkeys()}return a(e,t),e.prototype._refreshMonkeys=function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?null:arguments[0],r=(arguments.length<=1||void 0===arguments[1]?null:arguments[1],function n(e){var r=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];if(g["default"].object(e)){var i=void 0;for(i in e)if(e[i]instanceof p.MonkeyDefinition){var o,a=new p.Monkey(t,r.concat(i),e[i]);x(t._monkeys,C(r,(o={},o[i]=a,o)))}else n(e[i],r.concat(i))}});return e||r(this._data),this},e.prototype.select=function(t){if(t=t||[],arguments.length>1&&(t=P(arguments)),!g["default"].path(t))throw E("Baobab.select: invalid path.",{path:t});t=[].concat(t);var e=s(t),r=this._cursors[e];return r||(r=new c["default"](this,t,e),this._cursors[e]=r),this.emit("select",{path:t,cursor:r}),r},e.prototype.update=function(t,e){var r=this;if(t=k(t),!g["default"].operationType(e.type))throw E('Baobab.update: unknown operation type "'+e.type+'".',{operation:e});var n=O(this._data,t),i=n.solvedPath,o=n.exists;if(!i)throw E("Baobab.update: could not solve the given path.",{path:i});if("unset"!==e.type||o){this._transaction.length||(this._previousData=this.get());var a=b["default"](this._data,i,e,this.options),h=a.data,l=a.node;if(!("data"in a))return l;var f=i.concat("push"===e.type?l.length-1:[]),c=s(f);return this._data=h,this._affectedPathsIndex[c]=!0,this._transaction.push(u({},e,{path:f})),this.emit("write",{path:f}),this.options.autoCommit?this.options.asynchronous?(this._future||(this._future=setTimeout(function(){return r.commit()},0)),l):(this.commit(),l):l}},e.prototype.commit=function(){this._future&&(this._future=clearTimeout(this._future));var t=Object.keys(this._affectedPathsIndex).map(function(t){return"/"!==t?t.split("/").slice(1):[]}),e=this.options,r=e.validate,n=e.validationBehavior;if("function"==typeof r){var i=r.call(this,this._previousData,this._data,t);if(i instanceof Error&&(this.emit("invalid",{error:i}),"rollback"===n))return this._data=this._previousData,this._affectedPathsIndex={},this._transaction=[],this._previousData=this._data,this}var o=this._transaction,a=this._previousData;return this._affectedPathsIndex={},this._transaction=[],this._previousData=this._data,this.emit("update",{paths:t,currentData:this._data,transaction:o,previousData:a}),this},e.prototype.watch=function(t){return new y["default"](this,t)},e.prototype.release=function(){var t=void 0;delete this._data,delete this._previousData,delete this._transaction,delete this._affectedPathsIndex,delete this._monkeys;for(t in this._cursors)this._cursors[t].release();delete this._cursors,this.kill()},e.prototype.toJSON=function(){return this.serialize()},e.prototype.toString=function(){return this._identity},e}(l["default"]);r["default"]=D,D.monkey=function(){for(var t=arguments.length,e=Array(t),r=0;t>r;r++)e[r]=arguments[r];if(!e.length)throw new Error("Baobab.monkey: missing definition.");return 1===e.length?new p.MonkeyDefinition(e[0]):new p.MonkeyDefinition(e)},D.dynamicNode=D.monkey,D.Cursor=c["default"],D.MonkeyDefinition=p.MonkeyDefinition,D.Monkey=p.Monkey,D.type=g["default"],D.helpers=w,Object.defineProperty(D,"version",{value:"2.0.0-rc1"}),r["default"]=D,e.exports=r["default"]},{"./cursor":3,"./helpers":4,"./monkey":5,"./type":6,"./update":7,"./watcher":8,emmett:1}],3:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t,e){if(!e)throw p.makeError("Baobab.Cursor."+t+": "+("cannot use "+t+" on an unresolved dynamic path."),{path:e})}function s(t,e){d.prototype[t]=function(r,n){if(arguments.length>2)throw p.makeError("Baobab.Cursor."+t+": too many arguments.");if(1===arguments.length&&"unset"!==t&&(n=r,r=[]),r=p.coercePath(r),!c["default"].path(r))throw p.makeError("Baobab.Cursor."+t+": invalid path.",{path:r});if(e&&!e(n))throw p.makeError("Baobab.Cursor."+t+": invalid value.",{path:r,value:n});var i=this.solvedPath.concat(r);if(c["default"].readOnlyPath(i))throw p.makeError("Baobab.Cursor."+t+": trying to update a read-only path.",{path:i});return this.tree.update(i,{type:t,value:n})}}r.__esModule=!0;var u=t("emmett"),h=n(u),l=t("./monkey"),f=t("./type"),c=n(f),p=t("./helpers"),d=function(t){function e(r,n,o){var a=this;i(this,e),t.call(this),n=n||[],this._identity="[object Cursor]",this._archive=null,this.tree=r,this.path=n,this.hash=o,this.state={killed:!1,recording:!1,undoing:!1},this._dynamicPath=c["default"].dynamicPath(this.path),this._monkeyPath=c["default"].monkeyPath(this.tree._monkeys,this.path),this._dynamicPath?this.solvedPath=p.getIn(this.tree._data,this.path).solvedPath:this.solvedPath=this.path,this._writeHandler=function(t){var e=t.data;!a.state.killed&&p.solveUpdate([e.path],a._getComparedPaths())&&(a.solvedPath=p.getIn(a.tree._data,a.path).solvedPath)};var s=function(t){var e=a,r=Object.defineProperties({},{previousData:{get:function(){return p.getIn(t,e.solvedPath).data},configurable:!0,enumerable:!0},currentData:{get:function(){return e.get()},configurable:!0,enumerable:!0}});return a.state.recording&&!a.state.undoing&&a.archive.add(r.previousData),a.state.undoing=!1,a.emit("update",r)};this._updateHandler=function(t){if(!a.state.killed){var e=t.data,r=e.paths,n=e.previousData,i=s.bind(a,n),o=a._getComparedPaths();return p.solveUpdate(r,o)?i():void 0}};var u=!1;this._lazyBind=function(){return u?void 0:(u=!0,a._dynamicPath&&a.tree.on("write",a._writeHandler),a.tree.on("update",a._updateHandler))},this._dynamicPath?this._lazyBind():(this.on=p.before(this._lazyBind,this.on.bind(this)),this.once=p.before(this._lazyBind,this.once.bind(this)))}return o(e,t),e.prototype._getComparedPaths=function(){var t=this._monkeyPath?p.getIn(this.tree._monkeys,this._monkeyPath).data.relatedPaths():[];return[this.solvedPath].concat(t)},e.prototype.isRoot=function(){return!this.path.length},e.prototype.isLeaf=function(){return c["default"].primitive(this._get().data)},e.prototype.isBranch=function(){return!this.isRoot()&&!this.isLeaf()},e.prototype.root=function(){return this.tree.root},e.prototype.select=function(t){return arguments.length>1&&(t=p.arrayFrom(arguments)),this.tree.select(this.path.concat(t))},e.prototype.up=function(){return this.isRoot()?null:this.tree.select(this.path.slice(0,-1))},e.prototype.down=function(){if(a("down",this.solvedPath),!(this._get().data instanceof Array))throw Error("Baobab.Cursor.down: cannot go down on a non-list type.");return this.tree.select(this.solvedPath.concat(0))},e.prototype.left=function(){a("left",this.solvedPath);var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.left: cannot go left on a non-list type.");return t?this.tree.select(this.solvedPath.slice(0,-1).concat(t-1)):null},e.prototype.right=function(){a("right",this.solvedPath);var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.right: cannot go right on a non-list type.");return t+1===this.up()._get().data.length?null:this.tree.select(this.solvedPath.slice(0,-1).concat(t+1))},e.prototype.leftmost=function(){a("leftmost",this.solvedPath);var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.leftmost: cannot go left on a non-list type.");return this.tree.select(this.solvedPath.slice(0,-1).concat(0))},e.prototype.rightmost=function(){a("rightmost",this.solvedPath);var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.rightmost: cannot go right on a non-list type.");var e=this.up()._get().data;return this.tree.select(this.solvedPath.slice(0,-1).concat(e.length-1))},e.prototype.map=function(t,e){a("map",this.solvedPath);var r=this._get().data,n=arguments.length;if(!c["default"].array(r))throw Error("baobab.Cursor.map: cannot map a non-list type.");return r.map(function(i,o){return t.call(n>1?e:this,this.select(o),o,r)},this)},e.prototype._get=function(){var t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];if(!c["default"].path(t))throw p.makeError("Baobab.Cursor.getters: invalid path.",{path:t});return this.solvedPath?p.getIn(this.tree._data,this.solvedPath.concat(t)):{data:void 0,solvedPath:null,exists:!1}},e.prototype.exists=function(t){return t=p.coercePath(t),arguments.length>1&&(t=p.arrayFrom(arguments)),this._get(t).exists},e.prototype.get=function(t){t=p.coercePath(t),arguments.length>1&&(t=p.arrayFrom(arguments));var e=this._get(t),r=e.data,n=e.solvedPath;return this.tree.emit("get",{data:r,solvedPath:n,path:this.path.concat(t)}),r},e.prototype.serialize=function(t){if(t=p.coercePath(t),arguments.length>1&&(t=p.arrayFrom(arguments)),!c["default"].path(t))throw p.makeError("Baobab.Cursor.getters: invalid path.",{path:t});if(!this.solvedPath)return void 0;var e=this.solvedPath.concat(t),r=p.deepClone(p.getIn(this.tree._data,e).data),n=p.getIn(this.tree._monkeys,e).data,i=function o(t,e){if(c["default"].object(e)&&c["default"].object(t))for(var r in e)e[r]instanceof l.Monkey?delete t[r]:o(t[r],e[r])};return i(r,n),r},e.prototype.project=function(t){if(c["default"].object(t)){var e={};for(var r in t)e[r]=this.get(t[r]);return e}if(c["default"].array(t)){for(var e=[],n=0,i=t.length;i>n;n++)e.push(this.get(t[n]));return e}throw p.makeError("Baobab.Cursor.project: wrong projection.",{projection:t})},e.prototype.startRecording=function(t){if(t=t||1/0,1>t)throw p.makeError("Baobab.Cursor.startRecording: invalid max records.",{value:t});return this.archive?this:(this._lazyBind(),this.archive=new p.Archive(t),this.state.recording=!0,this)},e.prototype.stopRecording=function(){return this.state.recording=!1,this},e.prototype.undo=function(){var t=arguments.length<=0||void 0===arguments[0]?1:arguments[0];if(!this.state.recording)throw new Error("Baobab.Cursor.undo: cursor is not recording.");var e=this.archive.back(t);if(!e)throw Error("Baobab.Cursor.undo: cannot find a relevant record.");return this.state.undoing=!0,this.set(e),this},e.prototype.hasHistory=function(){return!(!this.archive||!this.archive.get().length)},e.prototype.getHistory=function(){return this.archive?this.archive.get():[]},e.prototype.clearHistory=function(){return this.archive&&this.archive.clear(),this},e.prototype.release=function(){this._dynamicPath&&this.tree.off("write",this._writeHandler),this.tree.off("update",this._updateHandler),this.hash&&delete this.tree._cursors[this.hash],delete this.tree,delete this.path,delete this.solvedPath,delete this.archive,this.kill(),this.state.killed=!0},e.prototype.toJSON=function(){return this.serialize()},e.prototype.toString=function(){return this._identity},e}(h["default"]);r["default"]=d,s("set"),s("unset"),s("apply",c["default"]["function"]),s("push"),s("concat",c["default"].array),s("unshift"),s("splice",c["default"].splicer),s("merge",c["default"].object),e.exports=r["default"]},{"./helpers":4,"./monkey":5,"./type":6,emmett:1}],4:[function(t,e,r){(function(e){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t){return g(t)}function a(t,e){return function(){t.apply(null,arguments),e.apply(null,arguments)}}function s(t){var e=t.source,r="";return t.global&&(r+="g"),t.multiline&&(r+="m"),t.ignoreCase&&(r+="i"),t.sticky&&(r+="y"),t.unicode&&(r+="u"),new RegExp(e,r)}function u(t,r){if(!r||"object"!=typeof r||r instanceof Error||"ArrayBuffer"in e&&r instanceof ArrayBuffer)return r;if(P["default"].array(r)){if(t){var n=void 0,i=void 0,o=[];for(n=0,i=r.length;i>n;n++)o.push(u(!0,r[n]));return o}return g(r)}if(r instanceof Date)return new Date(r.getTime());if(r instanceof RegExp)return s(r);if(P["default"].object(r)){var a=void 0,h={};for(a in r)r.hasOwnProperty(a)&&(h[a]=t&&"$"!==a[0]?u(!0,r[a]):r[a]);return h}return r}function h(t){return t||0===t||""===t?t:[]}function l(t,e){var r=!0,n=void 0;if(!t)return!1;for(n in e)if(P["default"].object(e[n]))r=r&&l(t[n],e[n]);else if(P["default"].array(e[n]))r=r&&!!~e[n].indexOf(t[n]);else if(t[n]!==e[n])return!1;return r}function f(t,e){if("object"==typeof e&&null!==e&&(Object.freeze(e),t))if(Array.isArray(e)){var r=void 0,n=void 0;for(r=0,n=e.length;n>r;r++)f(!0,e[r])}else{var i=void 0,o=void 0;for(o in e)i=e[o],i&&e.hasOwnProperty(o)&&"object"==typeof i&&!Object.isFrozen(i)&&f(!0,i)}}function c(t,e){if(!e)return B;var r=[],n=t,i=void 0,o=void 0,a=void 0;for(o=0,a=e.length;a>o;o++){if(!n)return{data:void 0,solvedPath:e,exists:!1};if("function"==typeof e[o]){if(!P["default"].array(n))return B;if(i=p(n,e[o]),!~i)return B;r.push(i),n=n[i]}else if("object"==typeof e[o]){if(!P["default"].array(n))return B;if(i=p(n,function(t){return l(t,e[o])}),!~i)return B;r.push(i),n=n[i]}else r.push(e[o]),n=n[e[o]]}return{data:n,solvedPath:r,exists:void 0!==n}}function p(t,e){var r=void 0,n=void 0;for(r=0,n=t.length;n>r;r++)if(e(t[r]))return r;return-1}function d(t,e){var r=new Error(t);for(var n in e)r[n]=e[n];return r}function y(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];var i=r[0],o=void 0,a=void 0,s=void 0,u=void 0;for(a=1,s=r.length;s>a;a++){o=r[a];for(u in o)!t||"object"!=typeof o[u]||o[u]instanceof _.Monkey?i[u]=o[u]:i[u]=y(!0,i[u]||{},o[u])}return i}function v(t,e){var r=t.length,n={},i=n,o=void 0;for(r||(n=e),o=0;r>o;o++)i[t[o]]=o+1===r?e:{},i=i[t[o]];return n}function g(t){var e=new Array(t.length),r=void 0,n=void 0;for(r=0,n=t.length;n>r;r++)e[r]=t[r];return e}function m(t,e){var r=void 0,n=void 0,i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,h=void 0,l=void 0;for(r=0,o=t.length;o>r;r++){if(u=t[r],!u.length)return!0;for(n=0,a=e.length;a>n;n++){if(h=e[n],!h||!h.length)return!0;for(i=0,s=h.length;s>i&&(l=h[i],l==u[i]);i++)if(i+1===s||i+1===u.length)return!0}}return!1}function b(t,e,r){for(var n=arguments.length,i=Array(n>3?n-3:0),o=3;n>o;o++)i[o-3]=arguments[o];return t.slice(0,e).concat(i).concat(t.slice(e+r))}r.__esModule=!0,r.arrayFrom=o,r.before=a,r.coercePath=h,r.getIn=c,r.makeError=d,r.pathObject=v,r.solveUpdate=m,r.splice=b;var _=t("./monkey"),w=t("./type"),P=n(w),k=Function.prototype,j=function(){function t(e){i(this,t),this.size=e,this.records=[]}return t.prototype.get=function(){return this.records},t.prototype.add=function(t){return this.records.unshift(t),this.records.length>this.size&&(this.records.length=this.size),this},t.prototype.clear=function(){return this.records=[],this},t.prototype.back=function(t){var e=this.records[t-1];return e&&(this.records=this.records.slice(t)),e},t}();r.Archive=j;var O=u.bind(null,!1),E=u.bind(null,!0);r.shallowClone=O,r.deepClone=E;var x="function"==typeof Object.freeze,C=x?f.bind(null,!1):k,M=x?f.bind(null,!0):k;r.freeze=C,r.deepFreeze=M;var B={data:void 0,solvedPath:null,exists:!1},A=y.bind(null,!1),D=y.bind(null,!0);r.shallowMerge=A,r.deepMerge=D;var z=function(){var t=0;return function(){return t++}}();r.uniqid=z}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./monkey":5,"./type":6}],5:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}r.__esModule=!0;var o=t("./type"),a=n(o),s=t("./update"),u=n(s),h=t("./helpers"),l=function c(t){var e=this;i(this,c);var r=a["default"].monkeyDefinition(t);if(!r)throw h.makeError("Baobab.monkey: invalid definition.",{definition:t});this.type=r,"object"===this.type?(this.getter=t.get,this.projection=t.cursors||{},this.paths=Object.keys(this.projection).map(function(t){return e.projection[t]})):(this.getter=t[t.length-1],this.projection=t.slice(0,-1),this.paths=this.projection),this.hasDynamicPaths=this.paths.some(a["default"].dynamicPath),this.isRecursive=!1};r.MonkeyDefinition=l;var f=function(){function t(e,r,n){var o=this;i(this,t),this.tree=e,this.path=r,this.definition=n,this.state={killed:!1},this.listener=function(t){var e=t.data.path;if(!o.state.killed){var r=h.solveUpdate([e],o.relatedPaths());r&&o.update()}},this.tree.on("write",this.listener),this.update()}return t.prototype.relatedPaths=function(){var t=this,e=this.definition,r=void 0;return r=e.hasDynamicPaths?e.paths.map(function(e){return h.getIn(t.tree._data,e).solvedPath}):e.paths,e.isRecursive?r.reduce(function(e,r){var n=a["default"].monkeyPath(t.tree._monkeys,r);if(!n)return e.concat([r]);var i=h.getIn(t.tree._monkeys,n).data;return e.concat(i.relatedPaths())},[]):r},t.prototype.update=function(){var t=this.tree.project(this.definition.projection),e=function(t,e,r){var n=null,i=!1;return function(){return i||(n=e.getter.apply(t,"object"===e.type?[r]:r),t.options.immutable&&h.deepFreeze(n),i=!0),n}}(this.tree,this.definition,t);return this.tree._data=u["default"](this.tree._data,this.path,{type:"monkey",value:e},this.tree.options).data,this},t.prototype.release=function(){delete this.tree,delete this.definition,this.tree.off("write",this.listener),this.state.killed=!0},t}();r.Monkey=f},{"./helpers":4,"./type":6,"./update":7}],6:[function(t,e,r){"use strict";function n(t,e){return e.some(function(e){return o[e](t)})}r.__esModule=!0;var i=t("./monkey"),o={};o.array=function(t){return Array.isArray(t)},o.object=function(t){return t&&"object"==typeof t&&!Array.isArray(t)&&!(t instanceof Date)&&!(t instanceof RegExp)},o.string=function(t){return"string"==typeof t},o.number=function(t){return"number"==typeof t},o["function"]=function(t){return"function"==typeof t},o.primitive=function(t){return t!==Object(t)},o.splicer=function(t){return!o.array(t)||t.length<2?!1:n(t[0],["number","function","object"])&&o.number(t[1])};var a=["string","number","function","object"];o.path=function(t){return t||0===t||""===t?[].concat(t).every(function(t){return n(t,a)}):!1},o.dynamicPath=function(t){return t.some(function(t){return o["function"](t)||o.object(t)})},o.monkeyPath=function(t,e){var r=[],n=t,o=void 0,a=void 0;for(o=0,a=e.length;a>o;o++){if(r.push(e[o]),"object"!=typeof n)return null;if(n=n[e[o]],n instanceof i.Monkey)return r}return null},o.readOnlyPath=function(t){return t.some(function(t){return"$"===t[0]})},o.monkeyDefinition=function(t){return o.object(t)?o["function"](t.get)&&(!t.cursors||o.object(t.cursors)&&Object.keys(t.cursors).every(function(e){return o.path(t.cursors[e])}))?"object":null:o.array(t)&&o["function"](t[t.length-1])&&t.slice(0,-1).every(function(t){return o.path(t)})?"array":null},o.watcherMapping=function(t){return o.object(t)&&Object.keys(t).every(function(e){return o.path(t[e])})};var s=["set","apply","push","unshift","concat","merge","splice","unset"];o.operationType=function(t){return"string"==typeof t&&!!~s.indexOf(t)},r["default"]=o,e.exports=r["default"]},{"./monkey":5}],7:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function i(t,e,r){return u.makeError('Baobab.update: cannot apply the "'+t+'" on '+("a non "+e+" (path: /"+r.join("/")+")."),{path:r})}function o(t,e,r){var n=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],o=r.type,a=r.value,h={root:t},l=["root"].concat(e),f=h,c=[],p=void 0,d=void 0,y=void 0;for(p=0,d=l.length;d>p;p++){if(y=l[p],p>0&&c.push(y),p===d-1){if("set"===o){if(n.pure&&f[y]===a)return{node:f[y]};f[y]=n.persistent?u.shallowClone(a):a}else if("monkey"===o)Object.defineProperty(f,y,{get:a,enumerable:!0});else if("apply"===o){var v=a(f[y]);if(n.pure&&v===a)return{node:f[y]};f[y]=n.persistent?u.shallowClone(v):v}else if("push"===o){if(!s["default"].array(f[y]))throw i("push","array",c);n.persistent?f[y]=f[y].concat([a]):f[y].push(a)}else if("unshift"===o){if(!s["default"].array(f[y]))throw i("unshift","array",c);n.persistent?f[y]=[a].concat(f[y]):f[y].unshift(a)}else if("concat"===o){if(!s["default"].array(f[y]))throw i("concat","array",c);n.persistent?f[y]=f[y].concat(a):f[y].push.apply(f[y],a)}else if("splice"===o){if(!s["default"].array(f[y]))throw i("splice","array",c);n.persistent?f[y]=u.splice.apply(null,[f[y]].concat(a)):f[y].splice.apply(f[y],a)}else if("unset"===o)s["default"].object(f)?delete f[y]:s["default"].array(f)&&f.splice(y,1);else if("merge"===o){if(!s["default"].object(f[y]))throw i("merge","object",c);n.persistent?f[y]=u.shallowMerge({},f[y],a):f[y]=u.shallowMerge(f[y],a)}n.immutable&&u.deepFreeze(f);break}s["default"].primitive(f[y])?f[y]={}:n.persistent&&(f[y]=u.shallowClone(f[y])),n.immutable&&d>0&&u.freeze(f),f=f[y]}return{data:h.root,node:f[y]}}r.__esModule=!0,r["default"]=o;var a=t("./type"),s=n(a),u=t("./helpers");e.exports=r["default"]},{"./helpers":4,"./type":6}],8:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}r.__esModule=!0;var a=t("emmett"),s=n(a),u=t("./cursor"),h=n(u),l=t("./type"),f=n(l),c=t("./helpers"),p=function(t){function e(r,n){var o=this;i(this,e),t.call(this),this.tree=r,this.mapping=null,this.state={killed:!1},this.refresh(n),this.handler=function(t){if(!o.state.killed){var e=o.getWatchedPaths();return c.solveUpdate(t.data.paths,e)?o.emit("update"):void 0}},this.tree.on("update",this.handler)}return o(e,t),e.prototype.getWatchedPaths=function(){var t=this,e=Object.keys(this.mapping).map(function(e){var r=t.mapping[e];return r instanceof h["default"]?r.solvedPath:t.mapping[e]});return e.reduce(function(e,r){if(f["default"].dynamicPath(r)&&(r=c.getIn(t.tree._data,r).solvedPath),!r)return e;var n=f["default"].monkeyPath(t.tree._monkeys,r);return n?e.concat(c.getIn(t.tree._monkeys,r).data.relatedPaths()):e.concat([r])},[])},e.prototype.refresh=function(t){if(!f["default"].watcherMapping(t))throw c.makeError("Baobab.watch: invalid mapping.",{mapping:t});this.mapping=t;var e={};for(var r in t)e[r]=t[r]instanceof h["default"]?t[r].path:t[r];this.get=this.tree.project.bind(this.tree,e)},e.prototype.release=function(){this.tree.off("update",this.handler),this.state.killed=!0,this.kill()},e}(s["default"]);r["default"]=p,e.exports=r["default"]},{"./cursor":3,"./helpers":4,"./type":6,emmett:1}]},{},[2])(2)});