/* baobab.js - Version: 2.0.0-dev12 - Author: Yomguithereal (Guillaume Plique) */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Baobab=t()}}(function(){var t;return function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){var r=t[a][1][e];return i(r?r:e)},l,l.exports,e,t,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,r,n){(function(){"use strict";function e(t,e){var r,n={};for(r in t)n[r]=t[r];for(r in e)n[r]=e[r];return n}function i(t){return!(!t||"object"!=typeof t||Array.isArray(t)||t instanceof Function||t instanceof RegExp)}function o(t,e,r){var n,i,o,a;for(i in t)e.call(r||null,i,t[i]);if(Object.getOwnPropertySymbols)for(n=Object.getOwnPropertySymbols(t),o=0,a=n.length;a>o;o++)e.call(r||null,n[o],t[n[o]])}function a(t,e){t=t||[];var r,n,i=[];for(n=0,r=t.length;r>n;n++)t[n].fn!==e&&i.push(t[n]);return i}var s={once:"boolean",scope:"object"},u=0,h=function(){this._enabled=!0,this.unbindAll()};h.prototype.unbindAll=function(){return this._handlers={},this._handlersAll=[],this._handlersComplex=[],this},h.prototype.on=function(t,e,r){var n,a,h,l,c,f,p;if(i(t))return o(t,function(t,r){this.on(t,r,e)},this),this;for("function"==typeof t&&(r=e,e=t,t=null),c=[].concat(t),n=0,a=c.length;a>n;n++){if(l=c[n],p={order:u++,fn:e},"string"==typeof l||"symbol"==typeof l)this._handlers[l]||(this._handlers[l]=[]),f=this._handlers[l],p.type=l;else if(l instanceof RegExp)f=this._handlersComplex,p.pattern=l;else{if(null!==l)throw Error("Emitter.on: invalid event.");f=this._handlersAll}for(h in r||{})s[h]&&(p[h]=r[h]);f.push(p)}return this},h.prototype.once=function(){var t=Array.prototype.slice.call(arguments),r=t.length-1;return i(t[r])&&t.length>1?t[r]=e(t[r],{once:!0}):t.push({once:!0}),this.on.apply(this,t)},h.prototype.off=function(t,e){var r,n,s,u;if(1===arguments.length&&"function"==typeof t){e=arguments[0];for(s in this._handlers)this._handlers[s]=a(this._handlers[s],e),0===this._handlers[s].length&&delete this._handlers[s];this._handlersAll=a(this._handlersAll,e),this._handlersComplex=a(this._handlersComplex,e)}else if(1!==arguments.length||"string"!=typeof t&&"symbol"!=typeof t)if(2===arguments.length){var h=[].concat(t);for(r=0,n=h.length;n>r;r++)u=h[r],this._handlers[u]=a(this._handlers[u],e),0===(this._handlers[u]||[]).length&&delete this._handlers[u]}else i(t)&&o(t,this.off,this);else delete this._handlers[t];return this},h.prototype.listeners=function(t){var e,r,n,i=this._handlersAll||[],o=!1;if(!t)throw Error("Emitter.listeners: no event provided.");for(i=i.concat(this._handlers[t]||[]),r=0,n=this._handlersComplex.length;n>r;r++)e=this._handlersComplex[r],~t.search(e.pattern)&&(o=!0,i.push(e));return this._handlersAll.length||o?i.sort(function(t,e){return t.order-e.order}):i.slice(0)},h.prototype.emit=function(t,e){if(!this._enabled)return this;if(i(t))return o(t,this.emit,this),this;var r,n,a,s,u,h,l,c,f=[].concat(t),p=[];for(u=0,l=f.length;l>u;u++){for(a=this.listeners(f[u]),h=0,c=a.length;c>h;h++)s=a[h],r={type:f[u],target:this},arguments.length>1&&(r.data=e),s.fn.call("scope"in s?s.scope:this,r),s.once&&p.push(s);for(h=p.length-1;h>=0;h--)n=p[h].type?this._handlers[p[h].type]:p[h].pattern?this._handlersComplex:this._handlersAll,n.splice(n.indexOf(p[h]),1)}return this},h.prototype.kill=function(){this.unbindAll(),this._handlers=null,this._handlersAll=null,this._handlersComplex=null,this._enabled=!1,this.unbindAll=this.on=this.once=this.off=this.emit=this.listeners=Function.prototype},h.prototype.disable=function(){return this._enabled=!1,this},h.prototype.enable=function(){return this._enabled=!0,this},h.version="3.1.1","undefined"!=typeof n?("undefined"!=typeof r&&r.exports&&(n=r.exports=h),n.Emitter=h):"function"==typeof t&&t.amd?t("emmett",[],function(){return h}):this.Emitter=h}).call(this)},{}],2:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t){return"/"+t.map(function(t){return g["default"]["function"](t)||g["default"].object(t)?"#"+_.uniqid()+"#":t}).join("/")}r.__esModule=!0;var s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},u=t("emmett"),h=n(u),l=t("./cursor"),c=n(l),f=t("./watcher"),p=n(f),d=t("./facet"),v=n(d),y=t("./type"),g=n(y),m=t("./update"),b=n(m),_=t("./helpers"),w={autoCommit:!0,asynchronous:!0,immutable:!0,persistent:!0,validate:null,validationBehavior:"rollback"},P=function(t){function e(r,n){var o=this;if(i(this,e),t.call(this),arguments.length<1&&(r={}),!g["default"].object(r)&&!g["default"].array(r))throw _.makeError("Baobab: invalid data.",{data:r});this.options=_.shallowMerge({},w,n),this.options.persistent||(this.options.immutable=!1),this._identity="[object Baobab]",this._cursors={},this._future=null,this._transaction=[],this._affectedPathsIndex={},this._computedDataIndex={},this._previousData=null,this._data=r,this.root=this.select(),this.options.immutable&&_.deepFreeze(this._data);var a=function(t){o[t]=function(){var e=this.root[t].apply(this.root,arguments);return e instanceof c["default"]?this:e}};["apply","concat","exists","get","push","merge","project","serialize","set","splice","unset","unshift"].forEach(a),this._initializeComputedDataIndex()}return o(e,t),e.prototype._initializeComputedDataIndex=function(){var t=this,e=function r(e){var n=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];if(!g["default"].primitive(e)&&g["default"].object(e)){var i=void 0;for(i in e)if("$"===i[0]){var o,a=new v["default"](t,n.concat(i),e[i]);_.deepMerge(t._computedDataIndex,_.pathObject(n,(o={},o[i]=a,o)))}else r(e[i],n.concat(i))}};return e(this._data)},e.prototype.select=function(t){if(t=t||[],arguments.length>1&&(t=_.arrayFrom(arguments)),!g["default"].path(t))throw _.makeError("Baobab.select: invalid path.",{path:t});t=[].concat(t);var e=a(t),r=this._cursors[e];return r||(r=new c["default"](this,t,e),this._cursors[e]=r),this.emit("select",{path:t,cursor:r}),r},e.prototype.update=function(t,e){var r=this;if(t=_.coercePath(t),!g["default"].operationType(e.type))throw _.makeError('Baobab.update: unknown operation type "'+e.type+'".',{operation:e});var n=_.getIn(this._data,t,this._computedDataIndex),i=n.solvedPath,o=n.exists;if(!i)throw _.makeError("Baobab.update: could not solve the given path.",{path:i});if("unset"!==e.type||o){this._transaction.length||(this._previousData=this.get());var u=a(i),h=b["default"](this._data,i,e,this.options),l=h.data,c=h.node;return this._data=l,this._affectedPathsIndex[u]=!0,this._transaction.push(s({},e,{path:i})),this.emit("write",{path:i}),this.options.autoCommit?this.options.asynchronous?(this._future||(this._future=setTimeout(function(){return r.commit()},0)),c):(this.commit(),c):c}},e.prototype.commit=function(){var t=this;this._future&&(this._future=clearTimeout(this._future));var e=Object.keys(this._affectedPathsIndex).map(function(t){return"/"!==t?t.split("/").slice(1):[]}),r=this.options,n=r.validate,i=r.validationBehavior;if("function"==typeof n){var o=n.call(this,this._previousData,this._data,e);if(o instanceof Error&&(this.emit("invalid",{error:o}),"rollback"===i))return this._data=this._previousData,this._affectedPathsIndex={},this._transaction=[],this._previousData=this._data,this}var a=this._transaction,s=this._previousData;return this._affectedPathsIndex={},this._transaction=[],this._previousData=this._data,this.emit("update",Object.defineProperties({paths:e,transaction:a,previousData:s},{currentData:{get:function(){return t.get()},configurable:!0,enumerable:!0}})),this},e.prototype.watch=function(t){return new p["default"](this,t)},e.prototype.release=function(){var t=void 0;delete this._data,delete this._transaction,delete this._affectedPathsIndex;for(t in this._cursors)this._cursors[t].release();delete this._cursors,this.kill()},e.prototype.toJSON=function(){return this.serialize()},e.prototype.toString=function(){return this._identity},e}(h["default"]);r["default"]=P,Object.defineProperty(P,"version",{value:"2.0.0-dev12"}),P.Cursor=c["default"],r["default"]=P,e.exports=r["default"]},{"./cursor":3,"./facet":4,"./helpers":5,"./type":6,"./update":7,"./watcher":8,emmett:1}],3:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t,e){if(!e)throw f.makeError("Baobab.Cursor."+t+": "+("cannot use "+t+" on an unresolved dynamic path."),{path:e})}function s(t,e){p.prototype[t]=function(r,n){if(arguments.length>2)throw f.makeError("Baobab.Cursor."+t+": too many arguments.");if(1===arguments.length&&"unset"!==t&&(n=r,r=[]),r=f.coercePath(r),!c["default"].path(r))throw f.makeError("Baobab.Cursor."+t+": invalid path.",{path:r});if(e&&!e(n))throw f.makeError("Baobab.Cursor."+t+": invalid value.",{path:r,value:n});var i=this.solvedPath.concat(r);if(c["default"].readOnlyPath(i))throw f.makeError("Baobab.Cursor."+t+": trying to update a read-only path.",{path:i});return this.tree.update(i,{type:t,value:n})}}r.__esModule=!0;var u=t("emmett"),h=n(u),l=t("./type"),c=n(l),f=t("./helpers"),p=function(t){function e(r,n,o){var a=this;i(this,e),t.call(this),n=n||[],this._identity="[object Cursor]",this._archive=null,this.tree=r,this.path=n,this.hash=o,this.state={killed:!1,recording:!1,undoing:!1},this._dynamicPath=c["default"].dynamicPath(this.path),this._facetPath=c["default"].facetPath(this.path),this.solvedPath=this._dynamicPath?this._getIn(this.path).solvedPath:this.path,this._writeHandler=function(t){var e=t.data;!a.state.killed&&f.solveUpdate([e.path],a._getComparedPaths())&&(a.solvedPath=a._getIn(a.path).solvedPath)};var s=function(t){var e=a,r=Object.defineProperties({},{previousData:{get:function(){return f.getIn(t,e.solvedPath).data},configurable:!0,enumerable:!0},currentData:{get:function(){return e.get()},configurable:!0,enumerable:!0}});return a.state.recording&&!a.state.undoing&&a.archive.add(r.previousData),a.state.undoing=!1,a.emit("update",r)};this._updateHandler=function(t){if(!a.state.killed){var e=t.data,r=e.paths,n=e.previousData,i=s.bind(a,n),o=a._getComparedPaths();return f.solveUpdate(r,o)?i():void 0}};var u=!1;this._lazyBind=function(){return u?void 0:(u=!0,a._dynamicPath&&a.tree.on("write",a._writeHandler),a.tree.on("update",a._updateHandler))},this._dynamicPath?this._lazyBind():(this.on=f.before(this._lazyBind,this.on.bind(this)),this.once=f.before(this._lazyBind,this.once.bind(this)))}return o(e,t),e.prototype._getIn=function(t){return f.getIn(this.tree._data,t,this.tree._computedDataIndex)},e.prototype._getComparedPaths=function(){var t=this._facetPath?f.getIn(this.tree._computedDataIndex,this._facetPath).data.relatedPaths():[];return[this.solvedPath].concat(t)},e.prototype.isRoot=function(){return!this.path.length},e.prototype.isLeaf=function(){return c["default"].primitive(this._get().data)},e.prototype.isBranch=function(){return!this.isRoot()&&!this.isLeaf()},e.prototype.root=function(){return this.tree.root},e.prototype.select=function(t){return arguments.length>1&&(t=f.arrayFrom(arguments)),this.tree.select(this.path.concat(t))},e.prototype.up=function(){return this.isRoot()?null:this.tree.select(this.path.slice(0,-1))},e.prototype.down=function(){if(a("down",this.solvedPath),!(this._get().data instanceof Array))throw Error("Baobab.Cursor.down: cannot go down on a non-list type.");return this.tree.select(this.solvedPath.concat(0))},e.prototype.left=function(){a("left",this.solvedPath);var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.left: cannot go left on a non-list type.");return t?this.tree.select(this.solvedPath.slice(0,-1).concat(t-1)):null},e.prototype.right=function(){a("right",this.solvedPath);var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.right: cannot go right on a non-list type.");return t+1===this.up()._get().data.length?null:this.tree.select(this.solvedPath.slice(0,-1).concat(t+1))},e.prototype.leftmost=function(){a("leftmost",this.solvedPath);var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.leftmost: cannot go left on a non-list type.");return this.tree.select(this.solvedPath.slice(0,-1).concat(0))},e.prototype.rightmost=function(){a("rightmost",this.solvedPath);var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.rightmost: cannot go right on a non-list type.");var e=this.up()._get().data;return this.tree.select(this.solvedPath.slice(0,-1).concat(e.length-1))},e.prototype.map=function(t,e){a("map",this.solvedPath);var r=this._get().data,n=arguments.length;if(!c["default"].array(r))throw Error("baobab.Cursor.map: cannot map a non-list type.");return r.map(function(i,o){return t.call(n>1?e:this,this.select(o),o,r)},this)},e.prototype._get=function(){var t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];if(!c["default"].path(t))throw f.makeError("Baobab.Cursor.getters: invalid path.",{path:t});return this.solvedPath?this._getIn(this.solvedPath.concat(t)):{data:void 0,solvedPath:null,exists:!1}},e.prototype.exists=function(t){return t=f.coercePath(t),arguments.length>1&&(t=f.arrayFrom(arguments)),this._get(t).exists},e.prototype.get=function(t){t=f.coercePath(t),arguments.length>1&&(t=f.arrayFrom(arguments));var e=this._get(t),r=e.data,n=e.solvedPath;return this.tree.emit("get",{data:r,solvedPath:n,path:this.path.concat(t)}),r},e.prototype.serialize=function(){var t=f.deepClone(this.get.apply(this,arguments)),e=function r(t){if(c["default"].object(t))for(var e in t)"$"===e[0]?delete t[e]:r(t[e])};return e(t),t},e.prototype.project=function(t){if(c["default"].object(t)){var e={};for(var r in t)e[r]=this.get(t[r]);return e}if(c["default"].array(t)){for(var e=[],n=0,i=t.length;i>n;n++)e.push(this.get(t[n]));return e}throw f.makeError("Baobab.Cursor.project: wrong projection.",{projection:t})},e.prototype.startRecording=function(t){if(t=t||1/0,1>t)throw f.makeError("Baobab.Cursor.startRecording: invalid max records.",{value:t});return this.archive?this:(this._lazyBind(),this.archive=new f.Archive(t),this.state.recording=!0,this)},e.prototype.stopRecording=function(){return this.state.recording=!1,this},e.prototype.undo=function(){var t=arguments.length<=0||void 0===arguments[0]?1:arguments[0];if(!this.state.recording)throw new Error("Baobab.Cursor.undo: cursor is not recording.");var e=this.archive.back(t);if(!e)throw Error("Baobab.Cursor.undo: cannot find a relevant record.");return this.state.undoing=!0,this.set(e),this},e.prototype.hasHistory=function(){return!(!this.archive||!this.archive.get().length)},e.prototype.getHistory=function(){return this.archive?this.archive.get():[]},e.prototype.clearHistory=function(){return this.archive&&this.archive.clear(),this},e.prototype.release=function(){this._dynamicPath&&this.tree.off("write",this._writeHandler),this.tree.off("update",this._updateHandler),this.hash&&delete this.tree._cursors[this.hash],delete this.tree,delete this.path,delete this.solvedPath,delete this.archive,this.kill(),this.state.killed=!0},e.prototype.toJSON=function(){return this.serialize()},e.prototype.toString=function(){return this._identity},e}(h["default"]);r["default"]=p,s("set"),s("unset"),s("apply",c["default"]["function"]),s("push"),s("concat",c["default"].array),s("unshift"),s("splice",c["default"].splicer),s("merge",c["default"].object),e.exports=r["default"]},{"./helpers":5,"./type":6,emmett:1}],4:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}r.__esModule=!0;var o=t("./type"),a=n(o),s=t("./helpers"),u=function(){function t(e,r,n){var o=this;i(this,t);var u=a["default"].facetDefinition(n);if(!u)throw s.makeError("Baobab.Facet: attempting to create a computed data node with a "+("wrong definition (path: /"+r.join("/")+")."),{path:r,definition:n});this.tree=e,this.computedData=null,this.type=u,"object"===u?(this.getter=n.get,this.projection=n.cursors||{},this.paths=Object.keys(this.projection).map(function(t){return o.projection[t]})):(this.getter=n[n.length-1],this.projection=n.slice(0,-1),this.paths=this.projection),this._hasDynamicPaths=this.paths.some(function(t){return a["default"].dynamicPath(t)}),this.isRecursive=this.paths.some(function(t){return!!a["default"].facetPath(t)}),this.state={computed:!1,killed:!1},this.listener=function(t){var e=t.data.path;if(!o.state.killed){var r=s.solveUpdate([e],o.relatedPaths());r&&(o.computedData=null,o.state.computed=!1)}},e.on("write",this.listener)}return t.prototype.relatedPaths=function(){var t=this,e=void 0;return e=this._hasDynamicPaths?this.paths.map(function(e){return s.getIn(t.tree._data,e,t.tree._computedDataIndex).solvedPath}):this.paths,this.isRecursive?e.reduce(function(e,r){var n=a["default"].facetPath(r);if(!n)return e.concat([r]);var i=s.getIn(t.tree._computedDataIndex,n).data;return e.concat(i.relatedPaths())},[]):e},t.prototype.get=function(){if(this.state.computed)return this.computedData;var t=this.tree.project(this.projection),e=this.getter.apply(this.tree,"object"===this.type?[t]:t);return this.state.computed=!0,this.computedData=e,this.tree.options.immutable&&s.deepFreeze(this.computedData),e},t.prototype.release=function(){delete this.getter,delete this.projection,delete this.paths,this.tree.off("write",this.listener),this.state.killed=!0},t}();r["default"]=u,e.exports=r["default"]},{"./helpers":5,"./type":6}],5:[function(t,e,r){(function(e){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t){return b(t)}function a(t,e){return function(){t.apply(null,arguments),e.apply(null,arguments)}}function s(t){var e=t.source,r="";return t.global&&(r+="g"),t.multiline&&(r+="m"),t.ignoreCase&&(r+="i"),t.sticky&&(r+="y"),t.unicode&&(r+="u"),new RegExp(e,r)}function u(t,r){if(!r||"object"!=typeof r||r instanceof Error||"ArrayBuffer"in e&&r instanceof ArrayBuffer)return r;if(O["default"].array(r)){if(t){var n=void 0,i=void 0,o=[];for(n=0,i=r.length;i>n;n++)o.push(u(!0,r[n]));return o}return b(r)}if(r instanceof Date)return new Date(r.getTime());if(r instanceof RegExp)return s(r);if(O["default"].object(r)){var a=void 0,h={};for(a in r)r.hasOwnProperty(a)&&(h[a]=t&&"$"!==a[0]?u(!0,r[a]):r[a]);return h}return r}function h(t){return t||0===t||""===t?t:[]}function l(t,e){var r=!0,n=void 0;if(!t)return!1;for(n in e)if(O["default"].object(e[n]))r=r&&l(t[n],e[n]);else if(O["default"].array(e[n]))r=r&&!!~e[n].indexOf(t[n]);else if(t[n]!==e[n])return!1;return r}function c(t){var e=void 0;for(e in t)"$"!==e[0]&&Object.defineProperty(t,e,{writable:!1,enumerable:!0})}function f(t,e){if("object"==typeof e&&null!==e){var r=Array.isArray(e),n=!r&&Object.keys(e).some(function(t){return"$"===t[0]});if(n?c(e):Object.freeze(e),t)if(r){var i=void 0,o=void 0;for(i=0,o=e.length;o>i;i++)f(!0,e[i])}else{var a=void 0,s=void 0;for(s in e)a=e[s],a&&e.hasOwnProperty(s)&&"object"==typeof a&&!Object.isFrozen(a)&&f(!0,a)}}}function p(t,e){for(var r in e)"$"===r[0]?t[r]=e[r].get():p(t[r],e[r]);return t}function d(t,e){var r=arguments.length<=2||void 0===arguments[2]?null:arguments[2];if(!e)return z;var n=[],i=t,o=r,a=void 0,s=void 0,u=void 0;for(s=0,u=e.length;u>s;s++){if(!i)return{data:void 0,solvedPath:e,exists:!1};if("function"==typeof e[s]){if(!O["default"].array(i))return z;if(a=v(i,e[s]),!~a)return z;n.push(a),i=i[a]}else if("object"==typeof e[s]){if(!O["default"].array(i))return z;if(a=v(i,function(t){return l(t,e[s])}),!~a)return z;n.push(a),i=i[a]}else n.push(e[s]),o&&"$"===e[s][0]?(i=o[e[s]].get(),o=null):(i=i[e[s]],o&&(o=o[e[s]]||null))}if(o&&Object.keys(o).length){var h=p({root:i},{root:o});i=h.root}return{data:i,solvedPath:n,exists:void 0!==i}}function v(t,e){var r=void 0,n=void 0;for(r=0,n=t.length;n>r;r++)if(e(t[r]))return r;return-1}function y(t,e){var r=new Error(t);for(var n in e)r[n]=e[n];return r}function g(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];var i=r[0],o=void 0,a=void 0,s=void 0,u=void 0;for(a=1,s=r.length;s>a;a++){o=r[a];for(u in o)t&&"object"==typeof o[u]&&"$"!==u[0]?i[u]=g(!0,i[u]||{},o[u]):(i[u]instanceof j["default"]&&i[u].release(),i[u]=o[u])}return i}function m(t,e){var r=t.length,n={},i=n,o=void 0;for(r||(n=e),o=0;r>o;o++)i[t[o]]=o+1===r?e:{},i=i[t[o]];return n}function b(t){var e=new Array(t.length),r=void 0,n=void 0;for(r=0,n=t.length;n>r;r++)e[r]=t[r];return e}function _(t,e){var r=void 0,n=void 0,i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,h=void 0,l=void 0;for(r=0,o=t.length;o>r;r++){if(u=t[r],!u.length)return!0;for(n=0,a=e.length;a>n;n++){if(h=e[n],!h||!h.length)return!0;for(i=0,s=h.length;s>i&&(l=h[i],l==u[i]);i++)if(i+1===s||i+1===u.length)return!0}}return!1}function w(t,e,r){for(var n=arguments.length,i=Array(n>3?n-3:0),o=3;n>o;o++)i[o-3]=arguments[o];return t.slice(0,e).concat(i).concat(t.slice(e+r))}r.__esModule=!0,r.arrayFrom=o,r.before=a,r.coercePath=h,r.getIn=d,r.makeError=y,r.merger=g,r.pathObject=m,r.solveUpdate=_,r.splice=w;var P=t("./facet"),j=n(P),x=t("./type"),O=n(x),E=Function.prototype,C=function(){function t(e){i(this,t),this.size=e,this.records=[]}return t.prototype.get=function(){return this.records},t.prototype.add=function(t){return this.records.unshift(t),this.records.length>this.size&&(this.records.length=this.size),this},t.prototype.clear=function(){return this.records=[],this},t.prototype.back=function(t){var e=this.records[t-1];return e&&(this.records=this.records.slice(t)),e},t}();r.Archive=C;var k=u.bind(null,!1),D=u.bind(null,!0);r.shallowClone=k,r.deepClone=D;var B="function"==typeof Object.freeze,I=B?f.bind(null,!1):E,A=B?f.bind(null,!0):E;r.freeze=I,r.deepFreeze=A;var z={data:void 0,solvedPath:null,exists:!1},M=g.bind(null,!1),F=g.bind(null,!0);r.shallowMerge=M,r.deepMerge=F;var T=function(){var t=0;return function(){return t++}}();r.uniqid=T}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./facet":4,"./type":6}],6:[function(t,e,r){"use strict";function n(t,e){return e.some(function(e){return i[e](t)})}r.__esModule=!0;var i={};i.array=function(t){return Array.isArray(t)},i.object=function(t){return!(!t||"object"!=typeof t||Array.isArray(t)||t instanceof Date||t instanceof RegExp)},i.string=function(t){return"string"==typeof t},i.number=function(t){return"number"==typeof t},i["function"]=function(t){return"function"==typeof t},i.primitive=function(t){return t!==Object(t)},i.splicer=function(t){return!i.array(t)||t.length<2?!1:n(t[0],["number","function","object"])&&i.number(t[1])};var o=["string","number","function","object"];i.path=function(t){return t||0===t||""===t?[].concat(t).every(function(t){return n(t,o)}):!1},i.dynamicPath=function(t){return t.some(function(t){return i["function"](t)||i.object(t)})},i.facetPath=function(t){var e=[],r=void 0,n=void 0;for(r=0,n=t.length;n>r;r++)if(e.push(t[r]),"$"===t[r][0])return e;return null},i.readOnlyPath=function(t){return t.some(function(t){return"$"===t[0]})},i.facetDefinition=function(t){return i.object(t)?!i["function"](t.get)||t.cursors&&!Object.keys(t).every(function(e){return i.path(t[e])})?null:"object":i.array(t)&&i["function"](t[t.length-1])&&t.slice(0,-1).every(function(t){return i.path(t)})?"array":null},i.watcherMapping=function(t){return i.object(t)&&Object.keys(t).every(function(e){return i.path(t[e])})};var a=["set","apply","push","unshift","concat","merge","splice","unset"];i.operationType=function(t){return"string"==typeof t&&!!~a.indexOf(t)},r["default"]=i,e.exports=r["default"]},{}],7:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function i(t,e,r){return u.makeError('Baobab.update: cannot apply the "'+t+'" on '+("a non "+e+" (path: /"+r.join("/")+")."),{path:r})}function o(t,e,r){var n=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],o=r.type,a=r.value,h={root:t},l=["root"].concat(e),c=h,f=[],p=void 0,d=void 0,v=void 0;for(p=0,d=l.length;d>p;p++){if(v=l[p],p>0&&f.push(v),p===d-1){if("set"===o)c[v]=n.persistent?u.shallowClone(a):a;else if("apply"===o){var y=a(c[v]);c[v]=n.persistent?u.shallowClone(y):y}else if("push"===o){if(!s["default"].array(c[v]))throw i("push","array",f);n.persistent?c[v]=c[v].concat([a]):c[v].push(a)}else if("unshift"===o){if(!s["default"].array(c[v]))throw i("unshift","array",f);n.persistent?c[v]=[a].concat(c[v]):c[v].unshift(a)}else if("concat"===o){if(!s["default"].array(c[v]))throw i("concat","array",f);n.persistent?c[v]=c[v].concat(a):c[v].push.apply(c[v],a)}else if("splice"===o){if(!s["default"].array(c[v]))throw i("splice","array",f);n.persistent?c[v]=u.splice.apply(null,[c[v]].concat(a)):c[v].splice.apply(c[v],a)}else if("unset"===o)s["default"].object(c)?delete c[v]:s["default"].array(c)&&c.splice(v,1);else if("merge"===o){if(!s["default"].object(c[v]))throw i("merge","object",f);c[v]=n.persistent?u.shallowMerge({},c[v],a):u.shallowMerge(c[v],a)}n.immutable&&u.deepFreeze(c);break}s["default"].primitive(c[v])?c[v]={}:n.persistent&&(c[v]=u.shallowClone(c[v])),n.immutable&&d>0&&u.freeze(c),c=c[v]}return{data:h.root,node:c[v]}}r.__esModule=!0,r["default"]=o;var a=t("./type"),s=n(a),u=t("./helpers");e.exports=r["default"]},{"./helpers":5,"./type":6}],8:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}r.__esModule=!0;var a=t("emmett"),s=n(a),u=t("./cursor"),h=n(u),l=t("./type"),c=n(l),f=t("./helpers"),p=function(t){function e(r,n){var o=this;i(this,e),t.call(this),this.tree=r,this.mapping=null,this.state={killed:!1},this.refresh(n),this.handler=function(t){if(!o.state.killed){var e=o.getWatchedPaths();return f.solveUpdate(t.data.paths,e)?o.emit("update"):void 0}},this.tree.on("update",this.handler)}return o(e,t),e.prototype.getWatchedPaths=function(){var t=this,e=Object.keys(this.mapping).map(function(e){var r=t.mapping[e];return r instanceof h["default"]?r.solvedPath:t.mapping[e]});return e.reduce(function(e,r){if(c["default"].dynamicPath(r)&&(r=f.getIn(t.tree._data,r,t.tree._computedDataIndex).solvedPath),!r)return e;var n=c["default"].facetPath(r);return e.concat(n?f.getIn(t.tree._computedDataIndex,r).data.relatedPaths():[r])},[])},e.prototype.refresh=function(t){if(!c["default"].watcherMapping(t))throw f.makeError("Baobab.watch: invalid mapping.",{mapping:t});this.mapping=t;var e={};for(var r in t)e[r]=t[r]instanceof h["default"]?t[r].path:t[r];this.get=this.tree.project.bind(this.tree,e)},e.prototype.release=function(){this.tree.off("update",this.handler),this.state.killed=!0,this.kill()},e}(s["default"]);r["default"]=p,e.exports=r["default"]},{"./cursor":3,"./helpers":5,"./type":6,emmett:1}]},{},[2])(2)});