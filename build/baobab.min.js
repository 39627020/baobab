/* baobab.js - Version: 2.0.0-dev - Author: Yomguithereal (Guillaume Plique) */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Baobab=t()}}(function(){var t;return function e(t,r,n){function o(a,u){if(!r[a]){if(!t[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var f=r[a]={exports:{}};t[a][0].call(f.exports,function(e){var r=t[a][1][e];return o(r?r:e)},f,f.exports,e,t,r,n)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r["default"]={autoCommit:!0,asynchronous:!0,immutable:!0,validate:null,validationBehavior:"rollback"},e.exports=r["default"]},{}],2:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(r,"__esModule",{value:!0});var o=t("./src/baobab"),i=n(o),a=t("./src/cursor"),u=n(a);Object.defineProperty(i["default"],"version",{value:"2.0.0-dev"}),i["default"].Cursor=u["default"],r["default"]=i["default"],e.exports=r["default"]},{"./src/baobab":4,"./src/cursor":5}],3:[function(e,r,n){(function(){"use strict";function e(t,e){var r,n={};for(r in t)n[r]=t[r];for(r in e)n[r]=e[r];return n}function o(t){return!(!t||"object"!=typeof t||Array.isArray(t)||t instanceof Function||t instanceof RegExp)}function i(t,e){t=t||[];var r,n,o=[];for(n=0,r=t.length;r>n;n++)t[n].fn!==e&&o.push(t[n]);return o}var a={once:"boolean",scope:"object"},u=0,s=function(){this._enabled=!0,this.unbindAll()};s.prototype.unbindAll=function(){return this._handlers={},this._handlersAll=[],this._handlersComplex=[],this},s.prototype.on=function(t,e,r){var n,i,s,l,f,c,h;if(o(t)){for(l in t)this.on(l,t[l],e);return this}for("function"==typeof t&&(r=e,e=t,t=null),f=[].concat(t),n=0,i=f.length;i>n;n++){if(l=f[n],h={order:u++,fn:e},"string"==typeof l)this._handlers[l]||(this._handlers[l]=[]),c=this._handlers[l],h.type=l;else if(l instanceof RegExp)c=this._handlersComplex,h.pattern=l;else{if(null!==l)throw Error("Emitter.on: invalid event.");c=this._handlersAll}for(s in r||{})a[s]&&(h[s]=r[s]);c.push(h)}return this},s.prototype.once=function(){var t=Array.prototype.slice.call(arguments),r=t.length-1;return o(t[r])&&t.length>1?t[r]=e(t[r],{once:!0}):t.push({once:!0}),this.on.apply(this,t)},s.prototype.off=function(t,e){var r,n,a,u;if(1===arguments.length&&"function"==typeof t){e=arguments[0];for(a in this._handlers)this._handlers[a]=i(this._handlers[a],e),0===this._handlers[a].length&&delete this._handlers[a];this._handlersAll=i(this._handlersAll,e),this._handlersComplex=i(this._handlersComplex,e)}else if(1===arguments.length&&"string"==typeof t)delete this._handlers[t];else if(2===arguments.length){var s=[].concat(t);for(r=0,n=s.length;n>r;r++)u=s[r],this._handlers[u]=i(this._handlers[u],e),0===(this._handlers[u]||[]).length&&delete this._handlers[u]}else if(o(t))for(a in t)this.off(a,t[a]);return this},s.prototype.listeners=function(t){var e,r,n,o=this._handlersAll||[],i=!1;if(!t)throw Error("Emitter.listeners: no event provided.");for(o=o.concat(this._handlers[t]||[]),r=0,n=this._handlersComplex.length;n>r;r++)e=this._handlersComplex[r],~t.search(e.pattern)&&(i=!0,o.push(e));return this._handlersAll.length||i?o.sort(function(t,e){return t.order-e.order}):o.slice(0)},s.prototype.emit=function(t,e){if(!this._enabled)return this;if(o(t)){for(var r in t)this.emit(r,t[r]);return this}var n,i,a,u,s,l,f,c,h=[].concat(t),d=[];for(s=0,f=h.length;f>s;s++){for(a=this.listeners(h[s]),l=0,c=a.length;c>l;l++)u=a[l],n={type:h[s],target:this},arguments.length>1&&(n.data=e),u.fn.call("scope"in u?u.scope:this,n),u.once&&d.push(u);for(l=d.length-1;l>=0;l--)i=d[l].type?this._handlers[d[l].type]:d[l].pattern?this._handlersComplex:this._handlersAll,i.splice(i.indexOf(d[l]),1)}return this},s.prototype.kill=function(){this.unbindAll(),this._handlers=null,this._handlersAll=null,this._handlersComplex=null,this._enabled=!1,this.unbindAll=this.on=this.once=this.off=this.emit=this.listeners=Function.prototype},s.prototype.disable=function(){return this._enabled=!1,this},s.prototype.enable=function(){return this._enabled=!0,this},s.version="3.0.1","undefined"!=typeof n?("undefined"!=typeof r&&r.exports&&(n=r.exports=s),n.Emitter=s):"function"==typeof t&&t.amd?t("emmett",[],function(){return s}):this.Emitter=s}).call(this)},{}],4:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}function a(t){return t.map(function(t){return p["default"]["function"](t)||p["default"].object(t)?"#"+g.uniqid()+"#":t}).join("|λ|")}Object.defineProperty(r,"__esModule",{value:!0});var u=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),s=function(t,e,r){for(var n=!0;n;){var o=t,i=e,a=r;u=l=s=void 0,n=!1,null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,i);if(void 0!==u){if("value"in u)return u.value;var s=u.get;return void 0===s?void 0:s.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return void 0;t=l,e=i,r=a,n=!0}},l=t("emmett"),f=n(l),c=t("./cursor"),h=n(c),d=t("./type"),p=n(d),v=t("./update"),y=n(v),b=t("../defaults"),m=n(b),g=t("./helpers"),_=function(t){function e(t,r){var n=this;if(o(this,e),s(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),arguments.length<1&&(t={}),!p["default"].object(t)&&!p["default"].array(t))throw g.makeError("Baobab: invalid data.",{data:t});this.options=g.shallowMerge(m["default"],r),this._identity="[object Baobab]",this._cursors={},this._future=null,this._transaction={},this.log=[],this.previousData=null,this.data=t,this.root=this.select(),this.options.immutable&&g.deepFreeze(this.data);var i=function(t){n[t]=function(){var e=this.root[t].apply(this.root,arguments);return e instanceof h["default"]?this:e}};["append","apply","get","prepend","push,","merge","set","splice","unset","unshift"].forEach(i)}return i(e,t),u(e,[{key:"select",value:function(t){if(t=t||[],arguments.length>1&&(t=g.arrayFrom(arguments)),!p["default"].path(t))throw g.makeError("Baobab.select: invalid path.",{path:t});t=[].concat(t);var e=a(t),r=this._cursors[e];return r||(r=new h["default"](this,t,e),this._cursors[e]=r),this.emit("select",{path:t,cursor:r}),r}},{key:"update",value:function(t,e){var r=this;t=t||0===t?t:[],this.previousData=this.data;var n=g.solvePath(this.data,t);if(!n)throw g.makeError("Baobab.update: could not solve the given path.",{path:n});var o=a(n),i=y["default"](this.data,n,e,this.options),u=i.data,s=i.node;return this.data=u,this._transaction[o]||(this._transaction[o]=[]),this._transaction[o].push(e),this.options.autoCommit?this.options.asynchronous?(this._future||(this._future=setTimeout(function(){return r.commit()},0)),s):(this.commit(),s):s}},{key:"commit",value:function(){this._future&&(this._future=clearTimeout(this._future));var t=this.options,e=t.validate,r=t.validationBehaviour;if("function"==typeof e){var n=e.call(this,this._transaction);if(n instanceof Error&&(this.emit("invalid",{error:n}),"rollback"===r))return this.data=this.previousData,this}var o=this._transaction,i=this.previousData;return this._transaction={},this.previousData=null,this.emit("update",{transaction:o,previousData:i,data:this.data,paths:Object.keys(o).map(function(t){return t.split("|λ|")})}),this}}]),e}(f["default"]);r["default"]=_,e.exports=r["default"]},{"../defaults":1,"./cursor":5,"./helpers":6,"./type":7,"./update":8,emmett:3}],5:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}function a(t,e){p.prototype[t]=function(r,n){if(arguments.length>2)throw d.makeError("Baobab.Cursor."+t+": too many arguments.");if(1===arguments.length&&"unset"!==t&&(n=r,r=[]),r=r||0===r?r:[],!h["default"].path(r))throw d.makeError("Baobab.Cursor."+t+": invalid path.",{path:r});if(e&&!e(n))throw d.makeError("Baobab.Cursor."+t+": invalid value.",{path:r,value:n});return this.tree.update(this.solvedPath.concat(r),{type:t,value:n})}}Object.defineProperty(r,"__esModule",{value:!0});var u=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),s=function(t,e,r){for(var n=!0;n;){var o=t,i=e,a=r;u=l=s=void 0,n=!1,null===o&&(o=Function.prototype);var u=Object.getOwnPropertyDescriptor(o,i);if(void 0!==u){if("value"in u)return u.value;var s=u.get;return void 0===s?void 0:s.call(a)}var l=Object.getPrototypeOf(o);if(null===l)return void 0;t=l,e=i,r=a,n=!0}},l=t("emmett"),f=n(l),c=t("./type"),h=n(c),d=t("./helpers"),p=function(t){function e(t,r,n){var i=this;o(this,e),s(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),r=r||[],this._identity="[object Cursor]",this._archive=null,this.tree=t,this.path=r,this.hash=n,this.state={recording:!1,undoing:!1},this._dynamicPath=h["default"].dynamicPath(this.path),this.solvedPath=this._dynamicPath?d.solvePath(this.tree.data,this.path):this.path;var a=function(t){var e=d.getIn(t,i.solvedPath);return i.state.recording&&!i.state.undoing&&i.archive.add(e),i.state.undoing=!1,i.emit("update",{data:i._get(),previousData:e})};this._updateHandler=function(t){var e=t.data,r=(e.paths,e.previousData),n=a.bind(i,r);return i._dynamicPath&&(i.solvedPath=solvedPath(i.tree.data,i.path)),i.isRoot()?n():void 0};var u=!1;this._lazyBind=function(){return u?void 0:(u=!0,i.tree.on("update",i._updateHandler))},this._dynamicPath?this._lazyBind():(this.on=d.before(this._lazyBind,this.on.bind(this)),this.once=d.before(this._lazyBind,this.once.bind(this)))}return i(e,t),u(e,[{key:"isRoot",value:function(){return!this.path.length}},{key:"isLeaf",value:function(){return h["default"].primitive(this._get())}},{key:"isBranch",value:function(){return!this.isRoot()&&!this.isLeaf()}},{key:"root",value:function(){return this.tree.root}},{key:"_get",value:function(t){var e=this.solvedPath.concat([].concat(t)),r=d.getIn(this.tree.data,e);return{data:r,solvedPath:e}}},{key:"get",value:function(t){t=t||0===t?t:[],arguments.length>1&&(t=d.arrayFrom(arguments));var e=this._get(t),r=e.data,n=e.solvedPath;return this.tree.emit("get",{data:r,path:n}),r}}]),e}(f["default"]);r["default"]=p,a("set"),a("unset"),a("apply",h["default"]["function"]),a("push"),a("append",h["default"].array),a("unshift"),a("prepend",h["default"].array),a("splice",h["default"].array),a("merge",h["default"].object),e.exports=r["default"]},{"./helpers":6,"./type":7,emmett:3}],6:[function(t,e,r){(function(e){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t){return Array.prototype.slice.call(t)}function a(t,e){return function(){t.apply(null,arguments),e.apply(null,arguments)}}function u(t,r){if(!r||"object"!=typeof r||r instanceof Error||"ArrayBuffer"in e&&r instanceof ArrayBuffer)return r;if(_["default"].array(r)){if(t){var n=void 0,o=void 0,i=[];for(n=0,o=r.length;o>n;n++)i.push(u(!0,r[n]));return i}return r.slice(0)}if(r instanceof Date)return new Date(r.getTime());if(r instanceof RegExp)return s(r);if(_["default"].object(r)){var a=void 0,l={};r.constructor&&r.constructor!==Object&&(l=Object.create(r.constructor.prototype));for(a in r)r.hasOwnProperty(a)&&(l[a]=t?u(!0,r[a]):r[a]);return l}return r}function s(t){var e=t.source,r="";return t.global&&(r+="g"),t.multiline&&(r+="m"),t.ignoreCase&&(r+="i"),t.sticky&&(r+="y"),t.unicode&&(r+="u"),new RegExp(e,r)}function l(t,e){var r=!0,n=void 0;if(!t)return!1;for(n in e)if(_["default"].object(e[n]))r=r&&l(t[n],e[n]);else if(_["default"].array(e[n]))r=r&&!!~e[n].indexOf(t[n]);else if(t[n]!==e[n])return!1;return r}function f(t,e){var r=void 0,n=void 0;for(r=0,n=t.length;n>r;r++)if(e(t[r]))return t[r]}function c(t,e){if("object"==typeof e&&(Object.freeze(e),t))if(Array.isArray(e)){var r=void 0,n=void 0;for(r=0,n=e.length;n>r;r++)c(e[r])}else{var o=void 0,i=void 0;for(i in e)o=e[i],o&&e.hasOwnProperty(i)&&"object"==typeof o&&!Object.isFrozen(o)&&c(o)}}function h(t,e){e=e||[];var r=t,n=void 0,o=void 0;for(n=0,o=e.length;o>n;n++){if(!r)return;if("function"==typeof e[n]){if(!_["default"].array(r))return;r=f(r,e[n])}else if("object"==typeof e[n]){if(!_["default"].array(r))return;r=f(r,function(t){return l(t,e[n])})}else r=r[e[n]]}return r}function d(t,e){var r=void 0,n=void 0;for(r=0,n=t.length;n>r;r++)if(e(t[r]))return r;return-1}function p(t,e){var r=new Error(t);for(var n in e)r[n]=e[n];return r}function v(t,e){var r={},n=void 0;for(n in t)r[n]=t[n];for(n in e)r[n]=e[n];return r}function y(t,e){var r=[],n=t,o=void 0,i=void 0,a=void 0;for(i=0,a=e.length;a>i;i++){if(!n)return null;if("function"==typeof e[i]){if(!_["default"].array(n))return;o=d(n,e[i]),r.push(o),n=n[o]}else if("object"==typeof e[i]){if(!_["default"].array(n))return;o=d(n,function(t){return l(t,e[i])}),r.push(o),n=n[o]}else r.push(e[i]),n=n[e[i]]||{}}return r}function b(t,e,r){for(var n=arguments.length,o=Array(n>3?n-3:0),i=3;n>i;i++)o[i-3]=arguments[i];return t.slice(0,e).concat(o).concat(t.slice(e+r))}Object.defineProperty(r,"__esModule",{value:!0});var m=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();r.arrayFrom=i,r.before=a,r.getIn=h,r.makeError=p,r.shallowMerge=v,r.solvePath=y,r.splice=b;var g=t("./type"),_=n(g),j=Function.prototype,w=function(){function t(e){o(this,t),this.size=e,this.records=[]}return m(t,[{key:"get",value:function(){return this.records}},{key:"add",value:function(t){this.records.unshift(t),this.records.length>this.size&&(this.records.length=this.size)}},{key:"back",value:function(t){var e=this.records[t-1];return e&&(e=this.records.slice(t)),e}}]),t}();r.Archive=w;var O=u.bind(null,!1),P=u.bind(null,!0);r.shallowClone=O,r.deepClone=P;var x="function"==typeof Object.freeze,k=x?c.bind(null,!1):j,A=x?c.bind(null,!0):j;r.freeze=k,r.deepFreeze=A;var E=function(){var t=0;return function(){return t++}}();r.uniqid=E}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./type":7}],7:[function(t,e,r){"use strict";function n(t,e){return e.some(function(e){return o[e](t)})}Object.defineProperty(r,"__esModule",{value:!0});var o={};o.array=function(t){return Array.isArray(t)},o.object=function(t){return!(!t||"object"!=typeof t||Array.isArray(t)||t instanceof Date||t instanceof RegExp)},o.string=function(t){return"string"==typeof t},o.number=function(t){return"number"==typeof t},o.positiveInteger=function(t){return"number"==typeof t&&t>0&&t%1===0},o["function"]=function(t){return"function"==typeof t},o.primitive=function(t){return t!==Object(t)},o.path=function(t,e){return t?(e=e||["string","number","function","object"],[].concat(t).every(function(t){return n(t,e)})):!1},o.dynamicPath=function(t){return t.some(function(t){return o["function"](t)||o.object(t)})},r["default"]=o,e.exports=r["default"]},{}],8:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function i(t,e){return l.makeError("Baobab.update: "+t,{path:e})}function a(t,e,r){var n=void 0===arguments[3]?{}:arguments[3],a=r.type,u=r.value,f={root:t},c=["root"].concat(o(e)),h=f,d=[],p=void 0,v=void 0,y=void 0;for(p=0,v=c.length;v>p;p++){if(y=c[p],p>0&&d.push(y),p===v-1){if("set"===a)h[y]=u;else if("splice"===a){if(!s["default"].array(h[y]))throw i('cannot apply the "splice" operation on a non array.',d);h[y]=l.splice.apply(null,[h[y]].concat(u))}else if("unset"===a)s["default"].object(h)&&delete h[y];else if("merge"===a){if(!s["default"].object(h[y]))throw i('cannot apply the "merge" operation on a non object.',d);h[y]=l.shallowMerge(h[y],u)}break}h[y]=s["default"].primitive(h[y])?{}:l.shallowClone(h[y]),n.immutable&&l.freeze(h),h=h[y]}return{data:f.root,node:h[y]}}Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=a;var u=t("./type"),s=n(u),l=t("./helpers");e.exports=r["default"]},{"./helpers":6,"./type":7}]},{},[2])(2)});