/* baobab.js - Version: 0.2.2 - Author: Yomguithereal (Guillaume Plique) */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r;"undefined"!=typeof window?r=window:"undefined"!=typeof global?r=global:"undefined"!=typeof self&&(r=self),r.Baobab=t()}}(function(){var t;return function r(t,e,n){function o(s,a){if(!e[s]){if(!t[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=e[s]={exports:{}};t[s][0].call(c.exports,function(r){var e=t[s][1][r];return o(e?e:r)},c,c.exports,r,t,e,n)}return e[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(t,r){r.exports={autoCommit:!0,asynchronous:!0,clone:!1,cloningFunction:null,cursorSingletons:!0,maxHistory:0,mixins:[],shiftReferences:!0,typology:null,validate:null}},{}],2:[function(t,r){var e=t("./src/baobab.js"),n=t("./src/helpers.js");Object.defineProperty(e,"version",{value:"0.2.2"}),e.getIn=n.getIn,r.exports=e},{"./src/baobab.js":6,"./src/helpers.js":9}],3:[function(t,r){function e(){}var n=r.exports={};n.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,r="undefined"!=typeof window&&window.MutationObserver,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};var n=[];if(r){var o=document.createElement("div"),i=new MutationObserver(function(){var t=n.slice();n.length=0,t.forEach(function(t){t()})});return i.observe(o,{attributes:!0}),function(t){n.length||o.setAttribute("yes","no"),n.push(t)}}return e?(window.addEventListener("message",function(t){var r=t.source;if((r===window||null===r)&&"process-tick"===t.data&&(t.stopPropagation(),n.length>0)){var e=n.shift();e()}},!0),function(t){n.push(t),window.postMessage("process-tick","*")}):function(t){setTimeout(t,0)}}(),n.title="browser",n.browser=!0,n.env={},n.argv=[],n.on=e,n.addListener=e,n.once=e,n.off=e,n.removeListener=e,n.removeAllListeners=e,n.emit=e,n.binding=function(){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(){throw new Error("process.chdir is not supported")}},{}],4:[function(r,e,n){(function(){"use strict";var r={once:"boolean",scope:"object"},o=function(){this._enabled=!0,this._children=[],this._handlers={},this._handlersAll=[]};o.prototype.on=function(t,e,n){var i,s,a,h,u,c;if("function"==typeof e){for(u="string"==typeof t?[t]:t,i=0,s=u.length;i!==s;i+=1)if(h=u[i]){this._handlers[h]||(this._handlers[h]=[]),c={handler:e};for(a in n||{}){if(!r[a])throw new Error('The option "'+a+'" is not recognized by Emmett.');c[a]=n[a]}this._handlers[h].push(c)}}else if(t&&"object"==typeof t&&!Array.isArray(t))for(h in t)o.prototype.on.call(this,h,t[h],e);else{if("function"!=typeof t)throw new Error("Wrong arguments.");c={handler:t};for(a in n||{}){if(!r[a])throw new Error('The option "'+a+'" is not recognized by Emmett.');c[a]=n[a]}this._handlersAll.push(c)}return this},o.prototype.once=function(t,r,e){if("function"==typeof r)e=e||{},e.once=!0,this.on(t,r,e);else{if((!t||"object"!=typeof t||Array.isArray(t))&&"function"!=typeof t)throw new Error("Wrong arguments.");r=r||{},r.once=!0,this.on(t,r)}return this},o.prototype.off=function(t,r){var e,n,o,i,s,a,h,u="string"==typeof t?[t]:t;if(1===arguments.length&&"function"==typeof u){r=arguments[0];for(s in this._handlers){for(a=[],e=0,n=this._handlers[s].length;e!==n;e+=1)this._handlers[s][e].handler!==r&&a.push(this._handlers[s][e]);this._handlers[s]=a}for(a=[],e=0,n=this._handlersAll.length;e!==n;e+=1)this._handlersAll[e].handler!==r&&a.push(this._handlersAll[e]);this._handlersAll=a}else if(2===arguments.length)for(e=0,n=u.length;e!==n;e+=1){if(h=u[e],this._handlers[h]){for(a=[],o=0,i=this._handlers[h].length;o!==i;o+=1)this._handlers[h][o].handler!==r&&a.push(this._handlers[h][o]);this._handlers[h]=a}this._handlers[h]&&0===this._handlers[h].length&&delete this._handlers[h]}return this},o.prototype.unbindAll=function(){var t;this._handlersAll=[];for(t in this._handlers)delete this._handlers[t];return this},o.prototype.emit=function(t,r){var e,n,o,i,s,a,h,u,c,p="string"==typeof t?[t]:t;if(!this._enabled)return this;for(r=void 0===r?{}:r,e=0,n=p.length;e!==n;e+=1)if(c=p[e],u=(this._handlers[c]||[]).concat(this._handlersAll),u.length){for(a={type:c,data:r||{},target:this},s=[],o=0,i=u.length;o!==i;o+=1)u[o].handler.call("scope"in u[o]?u[o].scope:this,a),u[o].once||s.push(u[o]);this._handlers[c]=s}for(e=0,n=this._children.length;e!==n;e+=1)h=this._children[e],h.emit.apply(h,arguments);return this},o.prototype.child=function(){var t=this,r=new o;return r.on("emmett:kill",function(){if(t._children)for(var e=0,n=t._children.length;n>e;e++)if(t._children[e]===r){t._children.splice(e,1);break}}),this._children.push(r),r},o.prototype.kill=function(){if(this.emit("emmett:kill"),this.unbindAll(),this._handlers=null,this._handlersAll=null,this._enabled=!1,this._children)for(var t=0,r=this._children.length;r>t;t++)this._children[t].kill();this._children=null},o.prototype.disable=function(){return this._enabled=!1,this},o.prototype.enable=function(){return this._enabled=!0,this},o.version="2.1.1","undefined"!=typeof n?("undefined"!=typeof e&&e.exports&&(n=e.exports=o),n.Emitter=o):"function"==typeof t&&t.amd?t("emmett",[],function(){return o}):this.Emitter=o}).call(this)},{}],5:[function(r,e,n){!function(){"use strict";function r(t){function r(t,o){var s,a,h,u,c,p,f,l,d=!1,y=!1,g=e.get(t);if("string"===e.get(o)){for(s=o.replace(/^[\?\!]/,"").split(/\|/),h=s.length,a=0;h>a;a++)if(i.indexOf(s[a])<0&&!(s[a]in n))throw new Error("Invalid type.");if(o.match(/^\?/)&&(d=!0),o.replace(/^\?/,"").match(/^\!/)&&(y=!0),y&&d)throw new Error("Invalid type.");for(a in s)if(n[s[a]]&&("function"==typeof n[s[a]].type?n[s[a]].type.call(e,t)===!0:!r(t,n[s[a]].type)))return y?(c=new Error,c.message='Expected a "'+o+'" but found a "'+s[a]+'".',c.expected=o,c.type=s[a],c.value=t,c):null;return null===t||void 0===t?y||d?null:(c=new Error,c.message='Expected a "'+o+'" but found a "'+g+'".',c.expected=o,c.type=g,c.value=t,c):(f=~s.indexOf("*"),l=~s.indexOf(g),y&&(f||l)?(c=new Error,c.message='Expected a "'+o+'" but found a "'+(l?g:"*")+'".',c.type=l?g:"*",c.expected=o,c.value=t,c):y||f||l?null:(c=new Error,c.message='Expected a "'+o+'" but found a "'+g+'".',c.expected=o,c.type=g,c.value=t,c))}if("object"===e.get(o)){if("object"!==g)return c=new Error,c.message='Expected an object but found a "'+g+'".',c.expected=o,c.type=g,c.value=t,c;for(u in o)if(p=r(t[u],o[u]))return c=p,c.path=c.path?[u].concat(c.path):[u],c;for(u in t)if(void 0===o[u])return c=new Error,c.message='Unexpected key "'+u+'".',c.type=g,c.value=t,c;return null}if("array"===e.get(o)){if(1!==o.length)throw new Error("Invalid type.");if("array"!==g)return c=new Error,c.message='Expected an array but found a "'+g+'".',c.expected=o,c.type=g,c.value=t,c;for(h=t.length,a=0;h>a;a++)if(p=r(t[a],o[0]))return c=p,c.path=c.path?[a].concat(c.path):[a],c;return null}throw new Error("Invalid type.")}var e=this,n={};if(this.add=function(t,r){var e,o,s,a,h,u;if(1===arguments.length){if("object"!==this.get(t))throw new Error("If types.add is called with one argument, this one has to be an object.");e=t,a=e.id,u=e.type}else{if(2!==arguments.length)throw new Error("types.add has to be called with one or two arguments.");if("string"!=typeof t||!t)throw new Error("If types.add is called with more than one argument, the first one must be the string id.");a=t,u=r}if("string"!==this.get(a)||0===a.length)throw new Error("A type requires an string id.");if(void 0!==n[a]&&"proto"!==n[a])throw new Error('The type "'+a+'" already exists.');if(~i.indexOf(a))throw new Error('"'+a+'" is a reserved type name.');n[a]=1,s=(e||{}).proto||[],s=Array.isArray(s)?s:[s],h={};for(o in s)void 0===n[s[o]]&&(n[s[o]]=1,h[s[o]]=1);if("function"!==this.get(u)&&!this.isValid(u))throw new Error("A type requires a valid definition. This one can be a preexistant type or else a function testing given objects.");if(n[a]=void 0===e?{id:a,type:u}:{},void 0!==e)for(o in e)n[a][o]=e[o];for(o in h)o!==a&&delete n[o];return this},this.has=function(t){return!!n[t]},this.get=function(t){return null===t||void 0===t?String(t):o[Object.prototype.toString.call(t)]||"object"},this.check=function(t,e,n){var o=r(t,e);if(n&&o)throw o;return!o},this.isValid=function(t){var r,e,o;if("string"===this.get(t)){r=t.replace(/^[\?\!]/,"").split(/\|/);for(o in r)if(i.indexOf(r[o])<0&&!(r[o]in n))return!1;return!0}if("object"===this.get(t)){for(e in t)if(!this.isValid(t[e]))return!1;return!0}return"array"===this.get(t)&&1===t.length?this.isValid(t[0]):!1},this.add("type",function(t){return this.isValid(t)}.bind(this)),this.add("primitive",function(t){return!t||!(t instanceof Object||"object"==typeof t)}),t=t||{},"object"!==this.get(t))throw Error("Invalid argument.");for(var s in t)this.add(s,t[s])}var o={},i=["*"];!function(){var t,r,e=["Arguments","Boolean","Number","String","Function","Array","Date","RegExp","Object"];for(t in e)r=e[t],i.push(r.toLowerCase()),o["[object "+r+"]"]=r.toLowerCase()}();var s=r;r.call(s),Object.defineProperty(s,"version",{value:"0.3.1"}),"undefined"!=typeof n?("undefined"!=typeof e&&e.exports&&(n=e.exports=s),n.types=s):"function"==typeof t&&t.amd?t("typology",[],function(){return s}):this.types=s}(this)},{}],6:[function(t,r){function e(t,r){if(!(this instanceof e))return new e(t,r);if(!u.check(t,"object|array"))throw Error("Baobab: invalid data.");if(o.call(this),this.options=h(r,p),this._cloner=this.options.cloningFunction||s.deepClone,this._futureUpdate={},this._willUpdate=!1,this._history=[],this._registeredCursors={},this.typology=this.options.typology?u.check(this.options.typology,"typology")?this.options.typology:new i(this.options.typology):new i,this.validate=this.options.validate||null,this.validate)try{this.typology.check(t,this.validate,!0)}catch(n){throw n.message="/"+n.path.join("/")+": "+n.message,n}this.data=this._cloner(t),this.mixin=c.baobab(this)}var n=t("./cursor.js"),o=t("emmett"),i=t("typology"),s=t("./helpers.js"),a=t("./update.js"),h=t("./merge.js"),u=t("./typology.js"),c=t("./mixins.js"),p=t("../defaults.json");s.inherits(e,o),e.prototype._stack=function(t){var r=this;if(!u.check(t,"object"))throw Error("Baobab.update: wrong specification.");return this._futureUpdate=h(t,this._futureUpdate),this.options.autoCommit?this.options.asynchronous?(this._willUpdate||(this._willUpdate=!0,s.later(function(){r.commit()})),this):this.commit():this},e.prototype._archive=function(){if(!(this.options.maxHistory<=0)){var t={data:this._cloner(this.data)};return this._history.length===this.options.maxHistory&&this._history.pop(),this._history.unshift(t),t}},e.prototype.commit=function(t){var r;if(t)this.data=t.data,r=t.log;else{var e=this._archive();r=a(this.data,this._futureUpdate,this.options),e&&(e.log=r)}if(this.validate){var n,o,i=[],h=r.length;for(o=0;h>o;o++)if(n=s.getIn(this.validate,r[o]))try{this.typology.check(this.get(r[o]),n,!0)}catch(u){u.path=r[o].concat(u.path||[]),i.push(u)}i.length&&this.emit("invalid",{errors:i})}return this.emit("update",{log:r}),this._futureUpdate={},this._willUpdate=!1,this},e.prototype.select=function(t){if(arguments.length>1&&(t=s.arrayOf(arguments)),!u.check(t,"path"))throw Error("Baobab.select: invalid path.");if(t="array"!==u.get(t)?[t]:t,this.options.cursorSingletons){var r=t.join("λ");if(this._registeredCursors[r])return this._registeredCursors[r];var e=new n(this,t);return this._registeredCursors[r]=e,e}return new n(this,t)},e.prototype.reference=function(t){if(arguments.length>1&&(t=s.arrayOf(arguments)),!u.check(t,"path"))throw Error("Baobab.get: invalid path.");return s.getIn(this.data,u.check(t,"string|number")?[t]:t)},e.prototype.get=function(){var t=this.reference.apply(this,arguments);return this.options.clone?this._cloner(t):t},e.prototype.clone=function(){return this._cloner(this.reference.apply(this,arguments))},e.prototype.set=function(t,r){if(arguments.length<2)throw Error("Baobab.set: expects a key and a value.");var e={};return e[t]={$set:r},this.update(e)},e.prototype.update=function(t){return this._stack(t)},e.prototype.hasHistory=function(){return!!this._history.length},e.prototype.getHistory=function(){return this._history},e.prototype.undo=function(){if(!this.hasHistory())throw Error("Baobab.undo: no history recorded, cannot undo.");var t=this._history.shift();this.commit(t)},u.add("baobab",function(t){return t instanceof e}),e.prototype.toJSON=function(){return this.reference()},r.exports=e},{"../defaults.json":1,"./cursor.js":8,"./helpers.js":9,"./merge.js":10,"./mixins.js":11,"./typology.js":12,"./update.js":13,emmett:4,typology:5}],7:[function(t,r){function e(t,r){r.on("update",t.cursorListener)}function n(t){var r=this;if(arguments.length<2)throw Error("baobab.Combination: not enough arguments.");var n=arguments[1],a=s.arrayOf(arguments).slice(2);if(n instanceof Array&&(a=n.slice(1),n=n[0]),!i.check(n,"cursor"))throw Error("baobab.Combination: argument should be a cursor.");if("or"!==t&&"and"!==t)throw Error("baobab.Combination: invalid operator.");o.call(this),this.cursors=[n],this.operators=[],this.root=n.root,this.updates=new Array(this.cursors.length),this.cursorListener=function(){r.updates[r.cursors.indexOf(this)]=!0},this.treeListener=function(){var t,e,n=r.updates[0];for(t=1,e=r.cursors.length;e>t;t++)n="or"===r.operators[t-1]?n||r.updates[t]:n&&r.updates[t];n&&r.emit("update"),r.updates=new Array(r.cursors.length)},this.root.on("update",this.treeListener),e(this,n),a.forEach(function(r){this[t](r)},this)}var o=t("emmett"),i=t("./typology.js"),s=t("./helpers.js");s.inherits(n,o),n.prototype.or=function(t){if(!i.check(t,"cursor"))throw Error("baobab.Combination.or: argument should be a cursor.");if(~this.cursors.indexOf(t))throw Error("baobab.Combination.or: cursor already in combination.");return this.cursors.push(t),this.operators.push("or"),this.updates.length++,e(this,t),this},n.prototype.and=function(t){if(!i.check(t,"cursor"))throw Error("baobab.Combination.and: argument should be a cursor.");if(~this.cursors.indexOf(t))throw Error("baobab.Combination.and: cursor already in combination.");return this.cursors.push(t),this.operators.push("and"),this.updates.length++,e(this,t),this},n.prototype.release=function(){this.unbindAll(),this.cursors.forEach(function(t){t.off("update",this.cursorListener)},this),this.root.off("update",this.treeListener),this.cursors=null,this.operators=null,this.root=null,this.updates=null},r.exports=n},{"./helpers.js":9,"./typology.js":12,emmett:4}],8:[function(t,r){function e(t,r){var e=this;n.call(this),r=r||[],this.root=t,this.path=r,this.relevant=void 0!==this.reference(),this.root.on("update",function(t){var r,n,o,i,s,a,h=t.data.log,u=!1;if(this._handlers.update.length||this._handlersAll.length){if(!e.path.length)return e.emit("update");t:for(s=0,o=h.length;o>s;s++)for(r=h[s],a=0,i=r.length;i>a&&(n=r[a],n===e.path[a]);a++)if(a+1===i||a+1===e.path.length){u=!0;break t}var c=void 0!==e.reference();e.relevant?c&&u?e.emit("update"):(e.emit("irrelevant"),e.relevant=!1):c&&u&&(e.emit("relevant"),e.emit("update"),e.relevant=!0)}}),this.mixin=i.cursor(this)}var n=t("emmett"),o=t("./combination.js"),i=t("./mixins.js"),s=t("./helpers.js"),a=t("./typology.js");s.inherits(e,n),e.prototype._stack=function(t){return this.root._stack(s.pathObject(this.path,t)),this},e.prototype.select=function(t){if(arguments.length>1&&(t=s.arrayOf(arguments)),!a.check(t,"path"))throw Error("baobab.Cursor.select: invalid path.");return this.root.select(this.path.concat(t))},e.prototype.up=function(){return this.path.length?this.root.select(this.path.slice(0,-1)):null},e.prototype.left=function(){var t=+this.path[this.path.length-1];if(isNaN(t))throw Error("baobab.Cursor.left: cannot go left on a non-list type.");return this.root.select(this.path.slice(0,-1).concat(t-1))},e.prototype.leftmost=function(){var t=+this.path[this.path.length-1];if(isNaN(t))throw Error("baobab.Cursor.leftmost: cannot go left on a non-list type.");return this.root.select(this.path.slice(0,-1).concat(0))},e.prototype.right=function(){var t=+this.path[this.path.length-1];if(isNaN(t))throw Error("baobab.Cursor.right: cannot go right on a non-list type.");return this.root.select(this.path.slice(0,-1).concat(t+1))},e.prototype.rightmost=function(){var t=+this.path[this.path.length-1];if(isNaN(t))throw Error("baobab.Cursor.right: cannot go right on a non-list type.");var r=this.up().reference();return this.root.select(this.path.slice(0,-1).concat(r.length-1))},e.prototype.down=function(){+this.path[this.path.length-1];if(!(this.reference()instanceof Array))throw Error("baobab.Cursor.down: cannot descend on a non-list type.");return this.root.select(this.path.concat(0))},e.prototype.get=function(t){return arguments.length>1&&(t=s.arrayOf(arguments)),this.root.get(a.check(t,"step")?this.path.concat(t):this.path)},e.prototype.reference=function(t){return arguments.length>1&&(t=s.arrayOf(arguments)),this.root.reference(a.check(t,"step")?this.path.concat(t):this.path)},e.prototype.clone=function(t){return arguments.length>1&&(t=s.arrayOf(arguments)),this.root.clone(a.check(t,"step")?this.path.concat(t):this.path)},e.prototype.set=function(t,r){if(arguments.length<2)throw Error("baobab.Cursor.set: expecting at least key/value.");var e={};return e[t]={$set:r},this.update(e)},e.prototype.edit=function(t){return this.update({$set:t})},e.prototype.apply=function(t){if("function"!=typeof t)throw Error("baobab.Cursor.apply: argument is not a function.");return this.update({$apply:t})},e.prototype.thread=function(t){if("function"!=typeof t)throw Error("baobab.Cursor.thread: argument is not a function.");return this.update({$thread:t})},e.prototype.push=function(t){if(!(this.reference()instanceof Array))throw Error("baobab.Cursor.push: trying to push to non-array value.");return this.update(arguments.length>1?{$push:s.arrayOf(arguments)}:{$push:t})},e.prototype.unshift=function(t){if(!(this.reference()instanceof Array))throw Error("baobab.Cursor.push: trying to push to non-array value.");return this.update(arguments.length>1?{$unshift:s.arrayOf(arguments)}:{$unshift:t})},e.prototype.update=function(t){return this._stack(t)},e.prototype.or=function(t){return new o("or",this,t)},e.prototype.and=function(t){return new o("and",this,t)},a.add("cursor",function(t){return t instanceof e}),e.prototype.toJSON=function(){return this.reference()},r.exports=e},{"./combination.js":7,"./helpers.js":9,"./mixins.js":11,"./typology.js":12,emmett:4}],9:[function(t,r){(function(e){function n(t){return Array.prototype.slice.call(t)}function o(t){if(!(t&&t instanceof Object))return t;if("array"===l.get(t))return t.slice(0);if("date"===l.get(t))return new Date(t.getTime());if("object"===l.get(t)){var r,e={};for(r in t)e[r]=t[r];return e}return t}function i(t){if(!(t&&t instanceof Object))return t;if("array"===l.get(t)){var r,e,n=[];for(r=0,e=t.length;e>r;r++)n.push(i(t[r]));return n}if("date"===l.get(t))return new Date(t.getTime());if("object"===l.get(t)){var o,s={};for(o in t)s[o]=i(t[o]);return s}return t}function s(t,r){return function(e){return r(t(e))}}function a(t,r){var e,n;for(e=0,n=t.length;n>e;e++)if(r(t[e]))return t[e]}function h(t,r){var e,n=!0;for(e in r)if("object"===l.get(r[e]))n=n&&h(t[e]);else if("array"===l.get(r[e]))n=n&&!!~r[e].indexOf(t[e]);else if(t[e]!==r[e])return!1;return n}function u(t,r){return a(t,function(t){return h(t,r)})}function c(t,r){r=r||[];var e,n,o=t;for(e=0,n=r.length;n>e;e++){if(!o)return;if("function"==typeof r[e]){if("array"!==l.get(o))return;o=a(o,r[e])}else if("object"==typeof r[e]){if("array"!==l.get(o))return;o=u(o,r[e])}else o=o[r[e]]}return o}function p(t,r){var e,n=t.length,o={},i=o;for(n||(o=r),e=0;n>e;e++)i[t[e]]=e+1===n?r:{},i=i[t[e]];return o}function f(t,r){t.super_=r;var e=function(){};e.prototype=r.prototype,t.prototype=new e,t.prototype.constructor=t}var l=t("typology"),d="undefined"==typeof window?e.nextTick:"requestAnimationFrame"in window?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,0)};r.exports={arrayOf:n,deepClone:i,shallowClone:o,compose:s,getIn:c,inherits:f,later:d,pathObject:p}}).call(this,t("_process"))},{_process:3,typology:5}],10:[function(t,r){function e(t,r){return r in(t||{})}function n(t,r){for(var n=0,o=r.length;o>n;n++)if(e(t,r[n]))return!0;return!1}function o(t,r,n){return e(t,n)&&e(r,n)}function i(){var t,r,e,h,u={},c=arguments.length;for(e=c-1;e>=0;e--)if(n(arguments[e],["$set","$apply","$chain"]))u.$set&&(arguments[e].$apply||arguments[e].$chain)?(delete u.$set,u.$apply=arguments[e].$apply||arguments[e].$chain):u.$apply&&arguments[e].$set?(delete u.$apply,u.$set=arguments[e].$set):arguments[e].$set?u.$set=arguments[e].$set:arguments[e].$apply?u.$apply=arguments[e].$apply:arguments[e].$chain&&(u.$apply=u.$apply?a.compose(u.$apply,arguments[e].$chain):arguments[e].$chain);else for(h in arguments[e])t=u[h],r=arguments[e][h],t&&s.check(r,"object")?o(t,r,"$push")?t.$push=s.check(t.$push,"array")?t.$push.concat(r.$push):[t.$push].concat(r.$push):o(t,r,"$unshift")?t.$unshift=s.check(r.$unshift,"array")?r.$unshift.concat(t.$unshift):[r.$unshift].concat(t.$unshift):u[h]=i(r,t):u[h]=r;return u}var s=t("typology"),a=t("./helpers.js");r.exports=i},{"./helpers.js":9,typology:5}],11:[function(t,r){var e=t("./typology.js"),n=t("./combination.js");r.exports={baobab:function(t){return{mixins:[{getInitialState:function(){if(this.tree=t,this.__type=null,this.cursor&&this.cursors)throw Error("baobab.mixin: you cannot have both `component.cursor` and `component.cursors`. Please make up your mind.");if(this.__updateHandler=function(){this.setState(this.__getCursorData())}.bind(this),this.cursor){if(!e.check(this.cursor,"string|number|array|cursor"))throw Error("baobab.mixin.cursor: invalid data (cursor, string or array).");e.check(this.cursor,"cursor")||(this.cursor=t.select(this.cursor)),this.__getCursorData=function(){return{cursor:this.cursor.get()}}.bind(this),this.__type="single"}else if(this.cursors){if(!e.check(this.cursors,"object|array"))throw Error("baobab.mixin.cursor: invalid data (object or array).");if(e.check(this.cursors,"array"))this.cursors=this.cursors.map(function(r){return e.check(r,"cursor")?r:t.select(r)}),this.__getCursorData=function(){return{cursors:this.cursors.map(function(t){return t.get()})}}.bind(this),this.__type="array";else{for(var r in this.cursors)e.check(this.cursors[r],"cursor")||(this.cursors[r]=t.select(this.cursors[r]));this.__getCursorData=function(){var t={};for(r in this.cursors)t[r]=this.cursors[r].get();return{cursors:t}}.bind(this),this.__type="object"}}return this.__getCursorData()},componentDidMount:function(){"single"===this.__type?this.cursor.on("update",this.__updateHandler):"array"===this.__type?(this.__combination=new n("or",this.cursors),this.__combination.on("update",this.__updateHandler)):"object"===this.__type&&(this.__combination=new n("or",Object.keys(this.cursors).map(function(t){return this.cursors[t]},this)),this.__combination.on("update",this.__updateHandler))},componentWillUnmount:function(){"single"===this.__type?this.cursor.off("update",this.__updateHandler):this.__combination.release()}}].concat(t.options.mixins)}},cursor:function(t){return{mixins:[{getInitialState:function(){return this.cursor=t,this.__updateHandler=function(){this.setState({cursor:this.cursor.get()})}.bind(this),{cursor:this.cursor.get()}},componentDidMount:function(){this.cursor.on("update",this.__updateHandler)},componentWillUnmount:function(){this.cursor.off("update",this.__updateHandler)}}].concat(t.root.options.mixins)}}}},{"./combination.js":7,"./typology.js":12}],12:[function(t,r){var e=t("typology"),n=new e({step:"string|number|array|function|object",path:function(t){return this.check(t,"?string|number|function|object")||this.check(t,["string|number|function|object"])},typology:function(t){return t instanceof e}});r.exports=n},{typology:5}],13:[function(t,r){function e(t,r){var e=new Error("precursors.update: "+r+" at path /"+t.toString());return e.path=t,e}function n(t,r,n){n=n||{};var s={};return function a(t,r,h){h=h||[];var u,c,p,f,l=h.join("λ");for(p in r)if(i[p])switch(f=r[p],s[l]=!0,p){case"$push":if(!o.check(t,"array"))throw e(h,"using command $push to a non array");o.check(f,"array")?t.push.apply(t,f):t.push(f);break;case"$unshift":if(!o.check(t,"array"))throw e(h,"using command $unshift to a non array");o.check(f,"array")?t.unshift.apply(t,f):t.unshift(f)}else if(c=l?l+"λ"+p:p,"$set"in(r[p]||{}))f=r[p].$set,s[c]=!0,t[p]=f;else if("$apply"in(r[p]||{})){if(u=r[p].$apply,"function"!=typeof u)throw e(h.concat(p),"using command $apply with a non function");s[c]=!0,t[p]=u.call(null,t[p])}else if(n.shiftReferences&&("$push"in(r[p]||{})||"$unshift"in(r[p]||{}))){if("$push"in(r[p]||{})){if(f=r[p].$push,!o.check(t[p],"array"))throw e(h.concat(p),"using command $push to a non array");t[p]=t[p].concat(f)}if("$unshift"in(r[p]||{})){if(f=r[p].$unshift,!o.check(t[p],"array"))throw e(h.concat(p),"using command $unshift to a non array");t[p]=(f instanceof Array?f:[f]).concat(t[p])}s[c]=!0}else"undefined"==typeof t[p]&&(t[p]={}),a(t[p],r[p],h.concat(p))}(t,r),Object.keys(s).map(function(t){return t.split("λ")})}var o=t("./typology.js"),i={};["$set","$push","$unshift","$apply"].forEach(function(t){i[t]=!0}),r.exports=n},{"./typology.js":12}]},{},[2])(2)});