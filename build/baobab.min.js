/* baobab.js - Version: 2.0.0-dev - Author: Yomguithereal (Guillaume Plique) */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Baobab=t()}}(function(){var t;return function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var h=r[a]={exports:{}};t[a][0].call(h.exports,function(e){var r=t[a][1][e];return i(r?r:e)},h,h.exports,e,t,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,r,n){(function(){"use strict";function e(t,e){var r,n={};for(r in t)n[r]=t[r];for(r in e)n[r]=e[r];return n}function i(t){return!(!t||"object"!=typeof t||Array.isArray(t)||t instanceof Function||t instanceof RegExp)}function o(t,e){t=t||[];var r,n,i=[];for(n=0,r=t.length;r>n;n++)t[n].fn!==e&&i.push(t[n]);return i}var a={once:"boolean",scope:"object"},s=0,u=function(){this._enabled=!0,this.unbindAll()};u.prototype.unbindAll=function(){return this._handlers={},this._handlersAll=[],this._handlersComplex=[],this},u.prototype.on=function(t,e,r){var n,o,u,l,h,f,c;if(i(t)){for(l in t)this.on(l,t[l],e);return this}for("function"==typeof t&&(r=e,e=t,t=null),h=[].concat(t),n=0,o=h.length;o>n;n++){if(l=h[n],c={order:s++,fn:e},"string"==typeof l)this._handlers[l]||(this._handlers[l]=[]),f=this._handlers[l],c.type=l;else if(l instanceof RegExp)f=this._handlersComplex,c.pattern=l;else{if(null!==l)throw Error("Emitter.on: invalid event.");f=this._handlersAll}for(u in r||{})a[u]&&(c[u]=r[u]);f.push(c)}return this},u.prototype.once=function(){var t=Array.prototype.slice.call(arguments),r=t.length-1;return i(t[r])&&t.length>1?t[r]=e(t[r],{once:!0}):t.push({once:!0}),this.on.apply(this,t)},u.prototype.off=function(t,e){var r,n,a,s;if(1===arguments.length&&"function"==typeof t){e=arguments[0];for(a in this._handlers)this._handlers[a]=o(this._handlers[a],e),0===this._handlers[a].length&&delete this._handlers[a];this._handlersAll=o(this._handlersAll,e),this._handlersComplex=o(this._handlersComplex,e)}else if(1===arguments.length&&"string"==typeof t)delete this._handlers[t];else if(2===arguments.length){var u=[].concat(t);for(r=0,n=u.length;n>r;r++)s=u[r],this._handlers[s]=o(this._handlers[s],e),0===(this._handlers[s]||[]).length&&delete this._handlers[s]}else if(i(t))for(a in t)this.off(a,t[a]);return this},u.prototype.listeners=function(t){var e,r,n,i=this._handlersAll||[],o=!1;if(!t)throw Error("Emitter.listeners: no event provided.");for(i=i.concat(this._handlers[t]||[]),r=0,n=this._handlersComplex.length;n>r;r++)e=this._handlersComplex[r],~t.search(e.pattern)&&(o=!0,i.push(e));return this._handlersAll.length||o?i.sort(function(t,e){return t.order-e.order}):i.slice(0)},u.prototype.emit=function(t,e){if(!this._enabled)return this;if(i(t)){for(var r in t)this.emit(r,t[r]);return this}var n,o,a,s,u,l,h,f,c=[].concat(t),d=[];for(u=0,h=c.length;h>u;u++){for(a=this.listeners(c[u]),l=0,f=a.length;f>l;l++)s=a[l],n={type:c[u],target:this},arguments.length>1&&(n.data=e),s.fn.call("scope"in s?s.scope:this,n),s.once&&d.push(s);for(l=d.length-1;l>=0;l--)o=d[l].type?this._handlers[d[l].type]:d[l].pattern?this._handlersComplex:this._handlersAll,o.splice(o.indexOf(d[l]),1)}return this},u.prototype.kill=function(){this.unbindAll(),this._handlers=null,this._handlersAll=null,this._handlersComplex=null,this._enabled=!1,this.unbindAll=this.on=this.once=this.off=this.emit=this.listeners=Function.prototype},u.prototype.disable=function(){return this._enabled=!1,this},u.prototype.enable=function(){return this._enabled=!0,this},u.version="3.0.1","undefined"!=typeof n?("undefined"!=typeof r&&r.exports&&(n=r.exports=u),n.Emitter=u):"function"==typeof t&&t.amd?t("emmett",[],function(){return u}):this.Emitter=u}).call(this)},{}],2:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function i(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}function s(t){return"/"+t.map(function(t){return m["default"]["function"](t)||m["default"].object(t)?"#"+w.uniqid()+"#":t}).join("/")}Object.defineProperty(r,"__esModule",{value:!0});var u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},l=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),h=function(t,e,r){for(var n=!0;n;){var i=t,o=e,a=r;s=l=u=void 0,n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;return void 0===u?void 0:u.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return void 0;t=l,e=o,r=a,n=!0}},f=t("emmett"),c=n(f),d=t("./cursor"),p=n(d),v=t("./facet"),y=n(v),g=t("./type"),m=n(g),b=t("./update"),_=n(b),w=t("./helpers"),j={autoCommit:!0,asynchronous:!0,immutable:!0,validate:null,validationBehavior:"rollback"},P=function(t){function e(t,r){var n=this;if(o(this,e),h(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),arguments.length<1&&(t={}),!m["default"].object(t)&&!m["default"].array(t))throw w.makeError("Baobab: invalid data.",{data:t});this.options=w.shallowMerge({},j,r),this._identity="[object Baobab]",this._cursors={},this._future=null,this._transaction=[],this._affectedPathsIndex={},this._computedDataIndex={},this.log=[],this.previousData=null,this.data=t,this.root=this.select(),this.options.immutable&&w.deepFreeze(this.data);var i=function(t){n[t]=function(){var e=this.root[t].apply(this.root,arguments);return e instanceof p["default"]?this:e}};["append","apply","get","prepend","push","merge","project","serialize","set","splice","unset","unshift"].forEach(i),this._refreshComputedDataIndex()}return a(e,t),l(e,[{key:"_refreshComputedDataIndex",value:function(t,e,r){var n=this,o=function a(t){var e=void 0===arguments[1]?[]:arguments[1];if(!m["default"].primitive(t)&&m["default"].object(t)){var r=void 0;for(r in t)if("$"===r[0]){var o=new y["default"](n,e.concat(r),t[r]);w.deepMerge(n._computedDataIndex,w.pathObject(e,i({},r,o)))}else a(t[r],e.concat(r))}};return t?void 0:o(this.data)}},{key:"select",value:function(t){if(t=t||[],arguments.length>1&&(t=w.arrayFrom(arguments)),!m["default"].path(t))throw w.makeError("Baobab.select: invalid path.",{path:t});t=[].concat(t);var e=s(t),r=this._cursors[e];return r||(r=new p["default"](this,t,e),this._cursors[e]=r),this.emit("select",{path:t,cursor:r}),r}},{key:"update",value:function(t,e){var r=this;t=t||0===t?t:[],this._transaction.length||(this.previousData=this.data);var n=w.solvePath(this.data,t);if(!n)throw w.makeError("Baobab.update: could not solve the given path.",{path:n});var i=s(n),o=_["default"](this.data,n,e,this.options),a=o.data,l=o.node;return this.data=a,this._affectedPathsIndex[i]=!0,this._transaction.push(u({},e,{path:n})),this.emit("write",{path:n}),this.options.autoCommit?this.options.asynchronous?(this._future||(this._future=setTimeout(function(){return r.commit()},0)),l):(this.commit(),l):l}},{key:"commit",value:function(){this._future&&(this._future=clearTimeout(this._future));var t=Object.keys(this._affectedPathsIndex).map(function(t){return"/"!==t?t.split("/").slice(1):[]}),e=this.options,r=e.validate,n=e.validationBehavior;if("function"==typeof r){var i=r.call(this,this.previousData,this.data,t);if(i instanceof Error&&(this.emit("invalid",{error:i}),"rollback"===n))return this.data=this.previousData,this._affectedPathsIndex={},this._transaction=[],this.previousData=this.data,this}var o=this._transaction,a=this.previousData;return this._affectedPathsIndex={},this._transaction=[],this.previousData=this.data,this.emit("update",{transaction:o,previousData:a,data:this.data,paths:t}),this}},{key:"release",value:function(){var t=void 0;delete this.data,delete this._transaction,delete this._affectedPathsIndex;for(t in this._cursors)this._cursors[t].release();delete this._cursors,this.kill()}},{key:"toJSON",value:function(){return this.serialize()}},{key:"toString",value:function(){return this._identity}}]),e}(c["default"]);r["default"]=P,Object.defineProperty(P,"version",{value:"2.0.0-dev"}),P.Cursor=p["default"],r["default"]=P,e.exports=r["default"]},{"./cursor":3,"./facet":4,"./helpers":5,"./type":6,"./update":7,emmett:1}],3:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}function a(t,e){p.prototype[t]=function(r,n){if(arguments.length>2)throw d.makeError("Baobab.Cursor."+t+": too many arguments.");if(1===arguments.length&&"unset"!==t&&(n=r,r=[]),r=r||0===r?r:[],!c["default"].path(r))throw d.makeError("Baobab.Cursor."+t+": invalid path.",{path:r});if(e&&!e(n))throw d.makeError("Baobab.Cursor."+t+": invalid value.",{path:r,value:n});var i=this.solvedPath.concat(r);if(c["default"].readOnlyPath(i))throw d.makeError("Baobab.Cursor."+t+": trying to update a read-only path.",{path:i});return this.tree.update(i,{type:t,value:n})}}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),u=function(t,e,r){for(var n=!0;n;){var i=t,o=e,a=r;s=l=u=void 0,n=!1,null===i&&(i=Function.prototype);var s=Object.getOwnPropertyDescriptor(i,o);if(void 0!==s){if("value"in s)return s.value;var u=s.get;return void 0===u?void 0:u.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return void 0;t=l,e=o,r=a,n=!0}},l=t("emmett"),h=n(l),f=t("./type"),c=n(f),d=t("./helpers"),p=function(t){function e(t,r,n){var o=this;i(this,e),u(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),r=r||[],this._identity="[object Cursor]",this._archive=null,this.tree=t,this.path=r,this.hash=n,this.state={recording:!1,undoing:!1},this._dynamicPath=c["default"].dynamicPath(this.path),this._facetPath=c["default"].facetPath(this.path),this.solvedPath=this._dynamicPath?d.solvePath(this.tree.data,this.path):this.path;var a=function(t){var e=d.getIn(t,o.solvedPath);return o.state.recording&&!o.state.undoing&&o.archive.add(e),o.state.undoing=!1,o.emit("update",{data:o._get().data,previousData:e})};this._updateHandler=function(t){var e=t.data,r=e.paths,n=e.previousData,i=a.bind(o,n),s=o._facetPath?d.getIn(o.tree._computedDataIndex,o._facetPath).paths:[];if(o.isRoot())return i();o._dynamicPath&&(o.solvedPath=d.solvePath(o.tree.data,o.path));var u=!1;return o.solvedPath&&(u=d.solveUpdate(r,[o.solvedPath].concat(s))),u?i():void 0};var s=!1;this._lazyBind=function(){return s?void 0:(s=!0,o.tree.on("update",o._updateHandler))},this._dynamicPath?this._lazyBind():(this.on=d.before(this._lazyBind,this.on.bind(this)),this.once=d.before(this._lazyBind,this.once.bind(this)))}return o(e,t),s(e,[{key:"isRoot",value:function(){return!this.path.length}},{key:"isLeaf",value:function(){return c["default"].primitive(this._get().data)}},{key:"isBranch",value:function(){return!this.isRoot()&&!this.isLeaf()}},{key:"root",value:function(){return this.tree.root}},{key:"select",value:function(t){return arguments.length>1&&(t=d.arrayFrom(arguments)),this.tree.select(this.path.concat(t))}},{key:"up",value:function(){return this.solvedPath&&!this.isRoot()?this.tree.select(this.path.slice(0,-1)):null}},{key:"down",value:function(){if(!(this._get().data instanceof Array))throw Error("Baobab.Cursor.down: cannot go down on a non-list type.");return this.tree.select(this.solvedPath.concat(0))}},{key:"left",value:function(){var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.left: cannot go left on a non-list type.");return t?this.tree.select(this.solvedPath.slice(0,-1).concat(t-1)):null}},{key:"right",value:function(){var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.right: cannot go right on a non-list type.");return t+1===this.up()._get().data.length?null:this.tree.select(this.solvedPath.slice(0,-1).concat(t+1))}},{key:"leftmost",value:function(){var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.leftmost: cannot go left on a non-list type.");return this.tree.select(this.solvedPath.slice(0,-1).concat(0))}},{key:"rightmost",value:function(){var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.rightmost: cannot go right on a non-list type.");var e=this.up()._get().data;return this.tree.select(this.solvedPath.slice(0,-1).concat(e.length-1))}},{key:"map",value:function(t,e){var r=this._get().data,n=arguments.length;if(!c["default"].array(r))throw Error("baobab.Cursor.map: cannot map a non-list type.");return r.map(function(i,o){return t.call(n>1?e:this,this.select(o),o,r)},this)}},{key:"_get",value:function(){var t=void 0===arguments[0]?[]:arguments[0],e=this.solvedPath.concat(t),r=d.getIn(this.tree.data,e,this.tree._computedDataIndex,this.tree.options);return{data:r,solvedPath:e}}},{key:"get",value:function(t){t=t||0===t?t:[],arguments.length>1&&(t=d.arrayFrom(arguments));var e=this._get(t),r=e.data,n=e.solvedPath;return this.tree.emit("get",{data:r,path:n}),r}},{key:"serialize",value:function(){var t=this.get.apply(this,arguments);return d.deepClone(t)}},{key:"project",value:function(t){if(c["default"].object(t)){var e={};for(var r in t)e[r]=this.get(t[r]);return e}if(c["default"].array(t)){for(var e=[],n=0,i=t.length;i>n;n++)e.push(this.get(t[n]));return e}throw d.makeError("Baobab.Cursor.project: wrong projection.",{projection:t})}},{key:"startRecording",value:function(t){if(t=t||1/0,1>t)throw d.makeError("Baobab.Cursor.startRecording: invalid max records.",{value:t});return this.archive?this:(this._lazyBind(),this.archive=new d.Archive(t),this.state.recording=!0,this)}},{key:"stopRecording",value:function(){return this.state.recording=!1,this}},{key:"undo",value:function(){var t=void 0===arguments[0]?1:arguments[0];if(!this.state.recording)throw new Error("Baobab.Cursor.undo: cursor is not recording.");var e=this.archive.back(t);if(!e)throw Error("Baobab.Cursor.undo: cannot find a relevant record.");return this.state.undoing=!0,this.set(e),this}},{key:"hasHistory",value:function(){return!(!this.archive||!this.archive.get().length)}},{key:"getHistory",value:function(){return this.archive?this.archive.get():[]}},{key:"clearHistory",value:function(){return this.archive&&this.archive.clear(),this}},{key:"release",value:function(){this.tree.off("update",this._updateHandler),delete this.tree._cursors[this.hash],delete this.tree,delete this.path,delete this.solvedPath,delete this.archive,this.kill()}},{key:"toJSON",value:function(){return this.serialize()}},{key:"toString",value:function(){return this._identity}}]),e}(h["default"]);r["default"]=p,a("set"),a("unset"),a("apply",c["default"]["function"]),a("push"),a("append",c["default"].array),a("unshift"),a("prepend",c["default"].array),a("splice",c["default"].array),a("merge",c["default"].object),e.exports=r["default"]},{"./helpers":5,"./type":6,emmett:1}],4:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=t("./type"),s=n(a),u=t("./helpers"),l=function(){function t(e,r,n){var o=this;i(this,t);var a=s["default"].facetDefinition(n);if(!a)throw u.makeError("Baobab.Facet: attempting to create a computed data node with a "+("wrong definition (path: /"+r.join("/")+")."),{path:r,definition:n});this.tree=e,this.computedData=null,this.type=a,"object"===a?(this.getter=n.get,this.projection=n.cursors||{},this.paths=Object.keys(this.projection).map(function(t){return o.projection[t]})):(this.getter=n[n.length-1],this.projection=n.slice(0,-1),this.paths=this.projection),this.state={computed:!1},this.listener=function(t){var e=t.data.path,r=u.solveUpdate([e],o.paths);r&&(o.computedData=null,o.state.computed=!1)},e.on("write",this.listener)}return o(t,[{key:"get",value:function(){if(this.state.computed)return this.computedData;var t=this.tree.project(this.projection),e=this.getter.apply(this.tree,"object"===this.type?[t]:t);return this.state.computed=!0,this.computedData=e,this.tree.options.immutable&&u.deepFreeze(this.computedData),e}},{key:"release",value:function(){delete this.getter,delete this.projection,delete this.paths,this.tree.off("write",this.listener)}}]),t}();r["default"]=l,e.exports=r["default"]},{"./helpers":5,"./type":6}],5:[function(t,e,r){(function(e){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t){return g(t)}function a(t,e){return function(){t.apply(null,arguments),e.apply(null,arguments)}}function s(t){var e=t.source,r="";return t.global&&(r+="g"),t.multiline&&(r+="m"),t.ignoreCase&&(r+="i"),t.sticky&&(r+="y"),t.unicode&&(r+="u"),new RegExp(e,r)}function u(t,r){if(!r||"object"!=typeof r||r instanceof Error||"ArrayBuffer"in e&&r instanceof ArrayBuffer)return r;if(P["default"].array(r)){if(t){var n=void 0,i=void 0,o=[];for(n=0,i=r.length;i>n;n++)o.push(u(!0,r[n]));return o}return g(r)}if(r instanceof Date)return new Date(r.getTime());if(r instanceof RegExp)return s(r);if(P["default"].object(r)){var a=void 0,l={};r.constructor&&r.constructor!==Object&&(l=Object.create(r.constructor.prototype));for(a in r)r.hasOwnProperty(a)&&"$"!==a[0]&&(l[a]=t?u(!0,r[a]):r[a]);return l}return r}function l(t,e){var r=!0,n=void 0;if(!t)return!1;for(n in e)if(P["default"].object(e[n]))r=r&&l(t[n],e[n]);else if(P["default"].array(e[n]))r=r&&!!~e[n].indexOf(t[n]);else if(t[n]!==e[n])return!1;return r}function h(t,e){var r=void 0,n=void 0;for(r=0,n=t.length;n>r;r++)if(e(t[r]))return t[r]}function f(t,e){if("object"==typeof e&&null!==e&&(Object.freeze(e),t))if(Array.isArray(e)){var r=void 0,n=void 0;for(r=0,n=e.length;n>r;r++)f(!0,e[r])}else{var i=void 0,o=void 0;for(o in e)i=e[o],i&&e.hasOwnProperty(o)&&"object"==typeof i&&!Object.isFrozen(i)&&f(!0,i)}}function c(t,e){var r=void 0===arguments[2]?null:arguments[2],n=void 0===arguments[3]?{}:arguments[3];e=e||[];var i=t,o=r,a=void 0,s=void 0;for(a=0,s=e.length;s>a;a++){if(!i)return;if("function"==typeof e[a]){if(!P["default"].array(i))return;i=h(i,e[a])}else if("object"==typeof e[a]){if(!P["default"].array(i))return;i=h(i,function(t){return l(t,e[a])})}else o&&"$"===e[a][0]?(i=o[e[a]].get(),o=null):(i=i[e[a]],o&&(o=o[e[a]]||null))}return o&&Object.keys(o).length&&!function(){i=E(i);var t=function e(t,r){for(var n in r)"$"===n[0]?t[n]=r[n].get():e(t[n],r[n])};t(i,o),n.immutable&&B(i)}(),i}function d(t,e){var r=void 0,n=void 0;for(r=0,n=t.length;n>r;r++)if(e(t[r]))return r;return-1}function p(t,e){var r=new Error(t);for(var n in e)r[n]=e[n];return r}function v(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];var i=r[0],o=void 0,a=void 0,s=void 0,u=void 0;for(a=1,s=r.length;s>a;a++){o=r[a];for(u in o)i[u]=t&&"object"==typeof o[u]&&"$"!==u[0]?v(!0,i[u]||{},o[u]):o[u]}return i}function y(t,e){var r=t.length,n={},i=n,o=void 0;for(r||(n=e),o=0;r>o;o++)i[t[o]]=o+1===r?e:{},i=i[t[o]];return n}function g(t){var e=new Array(t.length),r=void 0,n=void 0;for(r=0,n=t.length;n>r;r++)e[r]=t[r];return e}function m(t,e){var r=[],n=t,i=void 0,o=void 0,a=void 0;for(o=0,a=e.length;a>o;o++){if(!n)return null;if("function"==typeof e[o]){if(!P["default"].array(n))return;i=d(n,e[o]),r.push(i),n=n[i]}else if("object"==typeof e[o]){if(!P["default"].array(n))return;i=d(n,function(t){return l(t,e[o])}),r.push(i),n=n[i]}else r.push(e[o]),n=n[e[o]]||{}}return r}function b(t,e){var r=void 0,n=void 0,i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,l=void 0,h=void 0;for(r=0,o=t.length;o>r;r++){if(u=t[r],!u.length)return!0;for(n=0,a=e.length;a>n;n++){if(l=e[n],!l.length)return!0;for(i=0,s=l.length;s>i&&(h=l[i],h==u[i]);i++)if(i+1===s||i+1===u.length)return!0}}return!1}function _(t,e,r){for(var n=arguments.length,i=Array(n>3?n-3:0),o=3;n>o;o++)i[o-3]=arguments[o];return t.slice(0,e).concat(i).concat(t.slice(e+r))}Object.defineProperty(r,"__esModule",{value:!0});var w=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();r.arrayFrom=o,r.before=a,r.getIn=c,r.makeError=p,r.merger=v,r.pathObject=y,r.solvePath=m,r.solveUpdate=b,r.splice=_;var j=t("./type"),P=n(j),k=Function.prototype,O=function(){function t(e){i(this,t),this.size=e,this.records=[]}return w(t,[{key:"get",value:function(){return this.records}},{key:"add",value:function(t){return this.records.unshift(t),this.records.length>this.size&&(this.records.length=this.size),this}},{key:"clear",value:function(){return this.records=[],this}},{key:"back",value:function(t){var e=this.records[t-1];return e&&(this.records=this.records.slice(t)),e}}]),t}();r.Archive=O;var x=u.bind(null,!1),E=u.bind(null,!0);r.shallowClone=x,r.deepClone=E;var C="function"==typeof Object.freeze,A=C?f.bind(null,!1):k,B=C?f.bind(null,!0):k;r.freeze=A,r.deepFreeze=B;var D=v.bind(null,!1),z=v.bind(null,!0);r.shallowMerge=D,r.deepMerge=z;var M=function(){var t=0;return function(){return t++}}();r.uniqid=M}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./type":6}],6:[function(t,e,r){"use strict";function n(t,e){return e.some(function(e){return i[e](t)})}Object.defineProperty(r,"__esModule",{value:!0});var i={};i.array=function(t){return Array.isArray(t)},i.object=function(t){return!(!t||"object"!=typeof t||Array.isArray(t)||t instanceof Date||t instanceof RegExp)},i.string=function(t){return"string"==typeof t},i.number=function(t){return"number"==typeof t},i["function"]=function(t){return"function"==typeof t},i.primitive=function(t){return t!==Object(t)},i.path=function(t,e){return t||0===t?(e=e||["string","number","function","object"],[].concat(t).every(function(t){return n(t,e)})):!1},i.dynamicPath=function(t){return t.some(function(t){return i["function"](t)||i.object(t)})},i.facetPath=function(t){var e=[],r=void 0,n=void 0;for(r=0,n=t.length;n>r;r++)if(e.push(t[r]),"$"===t[r][0])return e;return null},i.readOnlyPath=function(t){return t.slice(0,-1).some(function(t){return"$"===t[0]})},i.facetDefinition=function(t){return i.object(t)?i["function"](t.get)?"object":null:i.array(t)&&i["function"](t[t.length-1])?"array":null},r["default"]=i,e.exports=r["default"]},{}],7:[function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function i(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function o(t,e,r){return l.makeError('Baobab.update: cannot apply the "'+t+'" on '+("a non "+e+" (path: /"+r.join("/")+")."),{path:r})}function a(t,e,r){var n=void 0===arguments[3]?{}:arguments[3],a=r.type,s=r.value,h={root:t},f=["root"].concat(i(e)),c=h,d=[],p=void 0,v=void 0,y=void 0;for(p=0,v=f.length;v>p;p++){if(y=f[p],p>0&&d.push(y),p===v-1){if("set"===a)c[y]=s;else if("apply"===a)c[y]=s(c[y]);else if("push"===a){if(!u["default"].array(c[y]))throw o("push","array",d);c[y]=c[y].concat([s])}else if("unshift"===a){if(!u["default"].array(c[y]))throw o("unshift","array",d);c[y]=[s].concat(c[y])}else if("append"===a){if(!u["default"].array(c[y]))throw o("append","array",d);c[y]=c[y].concat(s)}else if("prepend"===a){if(!u["default"].array(c[y]))throw o("prepend","array",d);c[y]=s.concat(c[y])}else if("splice"===a){if(!u["default"].array(c[y]))throw o("splice","array",d);c[y]=l.splice.apply(null,[c[y]].concat(s))}else if("unset"===a)u["default"].object(c)&&delete c[y];else if("merge"===a){if(!u["default"].object(c[y]))throw o("merge","object",d);c[y]=l.shallowMerge({},c[y],s)}n.immutable&&l.deepFreeze(c);break}c[y]=u["default"].primitive(c[y])?{}:l.shallowClone(c[y]),n.immutable&&v>0&&l.freeze(c),c=c[y]}return{data:h.root,node:c[y]}}Object.defineProperty(r,"__esModule",{value:!0}),r["default"]=a;var s=t("./type"),u=n(s),l=t("./helpers");e.exports=r["default"]},{"./helpers":5,"./type":6}]},{},[2])(2)});