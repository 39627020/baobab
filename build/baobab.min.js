/*
 * Baobab
 *
 * Homepage: https://github.com/Yomguithereal/baobab
 * Version: 2.5.0
 * Author: Yomguithereal (Guillaume Plique)
 * License: MIT
 */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Baobab=t()}}(function(){return function t(e,n,r){function o(a,s){if(!n[a]){if(!e[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var h=n[a]={exports:{}};e[a][0].call(h.exports,function(t){var n=e[a][1][t];return o(n||t)},h,h.exports,t,e,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e,n){(function(){"use strict";var t={once:"boolean",scope:"object"},r=0;function o(t){return t&&"object"==typeof t&&!Array.isArray(t)&&!(t instanceof Function)&&!(t instanceof RegExp)}function i(t,e,n){var r,o,i,a;for(o in t)e.call(n||null,o,t[o]);if(Object.getOwnPropertySymbols)for(i=0,a=(r=Object.getOwnPropertySymbols(t)).length;i<a;i++)e.call(n||null,r[i],t[r[i]])}var a=function(){this._enabled=!0,this.unbindAll()};function s(t,e){var n,r,o=[];for(r=0,n=(t=t||[]).length;r<n;r++)t[r].fn!==e&&o.push(t[r]);return o}a.prototype.unbindAll=function(){return this._handlers={},this._handlersAll=[],this._handlersComplex=[],this},a.prototype.on=function(e,n,a){var s,l,u,h,f,c,p;if(o(e))return i(e,function(t,e){this.on(t,e,n)},this),this;for("function"==typeof e&&(a=n,n=e,e=null),s=0,l=(f=[].concat(e)).length;s<l;s++){if(h=f[s],p={order:r++,fn:n},"string"==typeof h||"symbol"==typeof h)this._handlers[h]||(this._handlers[h]=[]),c=this._handlers[h],p.type=h;else if(h instanceof RegExp)c=this._handlersComplex,p.pattern=h;else{if(null!==h)throw Error("Emitter.on: invalid event.");c=this._handlersAll}for(u in a||{})t[u]&&(p[u]=a[u]);c.push(p)}return this},a.prototype.once=function(){var t=Array.prototype.slice.call(arguments),e=t.length-1;return o(t[e])&&t.length>1?t[e]=function(t,e){var n,r={};for(n in t)r[n]=t[n];for(n in e)r[n]=e[n];return r}(t[e],{once:!0}):t.push({once:!0}),this.on.apply(this,t)},a.prototype.off=function(t,e){var n,r,a,l;if(1===arguments.length&&"function"==typeof t){for(a in e=arguments[0],this._handlers)this._handlers[a]=s(this._handlers[a],e),0===this._handlers[a].length&&delete this._handlers[a];this._handlersAll=s(this._handlersAll,e),this._handlersComplex=s(this._handlersComplex,e)}else if(1!==arguments.length||"string"!=typeof t&&"symbol"!=typeof t)if(2===arguments.length){var u=[].concat(t);for(n=0,r=u.length;n<r;n++)l=u[n],this._handlers[l]=s(this._handlers[l],e),0===(this._handlers[l]||[]).length&&delete this._handlers[l]}else o(t)&&i(t,this.off,this);else delete this._handlers[t];return this},a.prototype.listeners=function(t){var e,n,r,o=this._handlersAll||[],i=!1;if(!t)throw Error("Emitter.listeners: no event provided.");for(o=o.concat(this._handlers[t]||[]),n=0,r=this._handlersComplex.length;n<r;n++)e=this._handlersComplex[n],~t.search(e.pattern)&&(i=!0,o.push(e));return this._handlersAll.length||i?o.sort(function(t,e){return t.order-e.order}):o.slice(0)},a.prototype.emit=function(t,e){if(!this._enabled)return this;if(o(t))return i(t,this.emit,this),this;var n,r,a,s,l,u,h,f,c=[].concat(t),p=[];for(l=0,h=c.length;l<h;l++){for(u=0,f=(a=this.listeners(c[l])).length;u<f;u++)s=a[u],n={type:c[l],target:this},arguments.length>1&&(n.data=e),s.fn.call("scope"in s?s.scope:this,n),s.once&&p.push(s);for(u=p.length-1;u>=0;u--)(r=p[u].type?this._handlers[p[u].type]:p[u].pattern?this._handlersComplex:this._handlersAll).splice(r.indexOf(p[u]),1)}return this},a.prototype.kill=function(){this.unbindAll(),this._handlers=null,this._handlersAll=null,this._handlersComplex=null,this._enabled=!1,this.unbindAll=this.on=this.once=this.off=this.emit=this.listeners=Function.prototype},a.prototype.disable=function(){return this._enabled=!1,this},a.prototype.enable=function(){return this._enabled=!0,this},a.version="3.1.1",void 0!==n?(void 0!==e&&e.exports&&(n=e.exports=a),n.Emitter=a):this.Emitter=a}).call(this)},{}],2:[function(t,e,n){"use strict";n.__esModule=!0;var r=h(t("emmett")),o=h(t("./cursor")),i=t("./monkey"),a=h(t("./watcher")),s=h(t("./type")),l=h(t("./update")),u=function(t){{if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}}(t("./helpers"));function h(t){return t&&t.__esModule?t:{default:t}}var f=u.arrayFrom,c=u.coercePath,p=u.deepFreeze,d=u.getIn,y=u.makeError,v=u.deepClone,m=u.deepMerge,b=u.shallowClone,g=u.shallowMerge,_=u.hashPath,w={autoCommit:!0,asynchronous:!0,immutable:!0,lazyMonkeys:!0,monkeyBusiness:!0,persistent:!0,pure:!0,validate:null,validationBehavior:"rollback"},k=function(t){function e(n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));if(arguments.length<1&&(n={}),!s.default.object(n)&&!s.default.array(n))throw y("Baobab: invalid data.",{data:n});i.options=g({},w,r),i.options.persistent||(i.options.immutable=!1,i.options.pure=!1),i._identity="[object Baobab]",i._cursors={},i._future=null,i._transaction=[],i._affectedPathsIndex={},i._monkeys={},i._previousData=null,i._data=n,i.root=new o.default(i,[],"λ"),delete i.root.release,i.options.immutable&&p(i._data);["apply","clone","concat","deepClone","deepMerge","exists","get","push","merge","pop","project","serialize","set","shift","splice","unset","unshift"].forEach(function(t){i[t]=function(){var e=this.root[t].apply(this.root,arguments);return e instanceof o.default?this:e}}),i.options.monkeyBusiness&&i._refreshMonkeys();var a=i.validate();if(a)throw Error("Baobab: invalid data.",{error:a});return i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._refreshMonkeys=function(t,e,n){var r=this,o=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(e instanceof i.MonkeyDefinition||e instanceof i.Monkey){var o=new i.Monkey(r,n,e instanceof i.Monkey?e.definition:e);(0,l.default)(r._monkeys,n,{type:"set",value:o},{immutable:!1,persistent:!1,pure:!1})}else if(s.default.object(e))for(var a in e)t(e[a],n.concat(a))};if(arguments.length){var a=d(this._monkeys,e).data;a&&function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(e instanceof i.Monkey)return e.release(),void(0,l.default)(r._monkeys,n,{type:"unset"},{immutable:!1,persistent:!1,pure:!1});if(s.default.object(e))for(var o in e)t(e[o],n.concat(o))}(a,e),"unset"!==n&&o(t,e)}else o(this._data);return this},e.prototype.validate=function(t){var e=this.options,n=e.validate,r=e.validationBehavior;if("function"!=typeof n)return null;var o=n.call(this,this._previousData,this._data,t||[[]]);return o instanceof Error?("rollback"===r&&(this._data=this._previousData,this._affectedPathsIndex={},this._transaction=[],this._previousData=this._data),this.emit("invalid",{error:o}),o):null},e.prototype.select=function(t){if(t=t||[],arguments.length>1&&(t=f(arguments)),!s.default.path(t))throw y("Baobab.select: invalid path.",{path:t});t=[].concat(t);var e=_(t),n=this._cursors[e];return n||(n=new o.default(this,t,e),this._cursors[e]=n),this.emit("select",{path:t,cursor:n}),n},e.prototype.update=function(t,e){var n=this;if(t=c(t),!s.default.operationType(e.type))throw y('Baobab.update: unknown operation type "'+e.type+'".',{operation:e});var r=d(this._data,t),o=r.solvedPath,i=r.exists;if(!o)throw y("Baobab.update: could not solve the given path.",{path:o});var a=s.default.monkeyPath(this._monkeys,o);if(a&&o.length>a.length)throw y("Baobab.update: attempting to update a read-only path.",{path:o});if("unset"!==e.type||i){var u=e;if(/merge/i.test(e.type)){var h=d(this._monkeys,o).data;if(s.default.object(h)){u=b(u);var f=d(this._data,o).data;/deep/i.test(u.type)?u.value=m({},m({},f,v(h)),u.value):u.value=g({},m({},f,v(h)),u.value)}}this._transaction.length||(this._previousData=this._data);var p=(0,l.default)(this._data,o,u,this.options),w=p.data,k=p.node;if(!("data"in p))return k;var P=o.concat("push"===e.type?k.length-1:[]),j=_(P);return this._data=w,this._affectedPathsIndex[j]=!0,this._transaction.push(g({},e,{path:P})),this.options.monkeyBusiness&&this._refreshMonkeys(k,o,e.type),this.emit("write",{path:P}),this.options.autoCommit?this.options.asynchronous?(this._future||(this._future=setTimeout(function(){return n.commit()},0)),k):(this.commit(),k):k}},e.prototype.commit=function(){if(!this._transaction.length)return this;this._future&&(this._future=clearTimeout(this._future));var t=Object.keys(this._affectedPathsIndex).map(function(t){return"λ"!==t?t.split("λ").slice(1):[]});if(this.validate(t))return this;var e=this._transaction,n=this._previousData;return this._affectedPathsIndex={},this._transaction=[],this._previousData=this._data,this.emit("update",{paths:t,currentData:this._data,transaction:e,previousData:n}),this},e.prototype.getMonkey=function(t){t=c(t);var e=d(this._monkeys,[].concat(t)).data;return e instanceof i.Monkey?e:null},e.prototype.watch=function(t){return new a.default(this,t)},e.prototype.release=function(){var t=void 0;for(t in this.emit("release"),delete this.root,delete this._data,delete this._previousData,delete this._transaction,delete this._affectedPathsIndex,delete this._monkeys,this._cursors)this._cursors[t].release();delete this._cursors,this.kill()},e.prototype.toJSON=function(){return this.serialize()},e.prototype.toString=function(){return this._identity},e}(r.default);n.default=k,k.monkey=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];if(!e.length)throw new Error("Baobab.monkey: missing definition.");return 1===e.length&&"function"!=typeof e[0]?new i.MonkeyDefinition(e[0]):new i.MonkeyDefinition(e)},k.dynamicNode=k.monkey,k.Cursor=o.default,k.MonkeyDefinition=i.MonkeyDefinition,k.Monkey=i.Monkey,k.type=s.default,k.helpers=u,k.VERSION="2.5.0"},{"./cursor":3,"./helpers":4,"./monkey":5,"./type":6,"./update":7,"./watcher":8,emmett:1}],3:[function(t,e,n){"use strict";n.__esModule=!0;var r=s(t("emmett")),o=t("./monkey"),i=s(t("./type")),a=t("./helpers");function s(t){return t&&t.__esModule?t:{default:t}}function l(t,e){if(!e)throw(0,a.makeError)("Baobab.Cursor."+t+": cannot use "+t+" on an unresolved dynamic path.",{path:e})}var u=function(t){function e(n,r,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));r=r||[],s._identity="[object Cursor]",s._archive=null,s.tree=n,s.path=r,s.hash=o,s.state={killed:!1,recording:!1,undoing:!1},s._dynamicPath=i.default.dynamicPath(s.path),s._monkeyPath=i.default.monkeyPath(s.tree._monkeys,s.path),s._dynamicPath?s.solvedPath=(0,a.getIn)(s.tree._data,s.path).solvedPath:s.solvedPath=s.path,s._writeHandler=function(t){var e=t.data;!s.state.killed&&(0,a.solveUpdate)([e.path],s._getComparedPaths())&&(s.solvedPath=(0,a.getIn)(s.tree._data,s.path).solvedPath)};s._updateHandler=function(t){if(!s.state.killed){var e=t.data,n=e.paths,r=e.previousData,o=function(t){var e=s,n={get previousData(){return(0,a.getIn)(t,e.solvedPath).data},get currentData(){return e.get()}};return s.state.recording&&!s.state.undoing&&s.archive.add(n.previousData),s.state.undoing=!1,s.emit("update",n)}.bind(s,r),i=s._getComparedPaths();return(0,a.solveUpdate)(n,i)?o():void 0}};var l=!1;return s._lazyBind=function(){if(!l)return l=!0,s._dynamicPath&&s.tree.on("write",s._writeHandler),s.tree.on("update",s._updateHandler)},s._dynamicPath?s._lazyBind():(s.on=(0,a.before)(s._lazyBind,s.on.bind(s)),s.once=(0,a.before)(s._lazyBind,s.once.bind(s))),s}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype._getComparedPaths=function(){var t=this._monkeyPath?(0,a.getIn)(this.tree._monkeys,this._monkeyPath).data.relatedPaths():[];return[this.solvedPath].concat(t)},e.prototype.isRoot=function(){return!this.path.length},e.prototype.isLeaf=function(){return i.default.primitive(this._get().data)},e.prototype.isBranch=function(){return!this.isRoot()&&!this.isLeaf()},e.prototype.root=function(){return this.tree.select()},e.prototype.select=function(t){return arguments.length>1&&(t=(0,a.arrayFrom)(arguments)),this.tree.select(this.path.concat(t))},e.prototype.up=function(){return this.isRoot()?null:this.tree.select(this.path.slice(0,-1))},e.prototype.down=function(){if(l("down",this.solvedPath),!(this._get().data instanceof Array))throw Error("Baobab.Cursor.down: cannot go down on a non-list type.");return this.tree.select(this.solvedPath.concat(0))},e.prototype.left=function(){l("left",this.solvedPath);var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.left: cannot go left on a non-list type.");return t?this.tree.select(this.solvedPath.slice(0,-1).concat(t-1)):null},e.prototype.right=function(){l("right",this.solvedPath);var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.right: cannot go right on a non-list type.");return t+1===this.up()._get().data.length?null:this.tree.select(this.solvedPath.slice(0,-1).concat(t+1))},e.prototype.leftmost=function(){l("leftmost",this.solvedPath);var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.leftmost: cannot go left on a non-list type.");return this.tree.select(this.solvedPath.slice(0,-1).concat(0))},e.prototype.rightmost=function(){l("rightmost",this.solvedPath);var t=+this.solvedPath[this.solvedPath.length-1];if(isNaN(t))throw Error("Baobab.Cursor.rightmost: cannot go right on a non-list type.");var e=this.up()._get().data;return this.tree.select(this.solvedPath.slice(0,-1).concat(e.length-1))},e.prototype.map=function(t,e){l("map",this.solvedPath);var n=this._get().data,r=arguments.length;if(!i.default.array(n))throw Error("baobab.Cursor.map: cannot map a non-list type.");return n.map(function(o,i){return t.call(r>1?e:this,this.select(i),i,n)},this)},e.prototype._get=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!i.default.path(t))throw(0,a.makeError)("Baobab.Cursor.getters: invalid path.",{path:t});return this.solvedPath?(0,a.getIn)(this.tree._data,this.solvedPath.concat(t)):{data:void 0,solvedPath:null,exists:!1}},e.prototype.exists=function(t){return t=(0,a.coercePath)(t),arguments.length>1&&(t=(0,a.arrayFrom)(arguments)),this._get(t).exists},e.prototype.get=function(t){t=(0,a.coercePath)(t),arguments.length>1&&(t=(0,a.arrayFrom)(arguments));var e=this._get(t),n=e.data,r=e.solvedPath;return this.tree.emit("get",{data:n,solvedPath:r,path:this.path.concat(t)}),n},e.prototype.clone=function(){var t=this.get.apply(this,arguments);return(0,a.shallowClone)(t)},e.prototype.deepClone=function(){var t=this.get.apply(this,arguments);return(0,a.deepClone)(t)},e.prototype.serialize=function(t){if(t=(0,a.coercePath)(t),arguments.length>1&&(t=(0,a.arrayFrom)(arguments)),!i.default.path(t))throw(0,a.makeError)("Baobab.Cursor.getters: invalid path.",{path:t});if(this.solvedPath){var e=this.solvedPath.concat(t),n=(0,a.deepClone)((0,a.getIn)(this.tree._data,e).data);return function t(e,n){if(i.default.object(n)&&i.default.object(e))for(var r in n)n[r]instanceof o.Monkey?delete e[r]:t(e[r],n[r])}(n,(0,a.getIn)(this.tree._monkeys,e).data),n}},e.prototype.project=function(t){if(i.default.object(t)){var e={};for(var n in t)e[n]=this.get(t[n]);return e}if(i.default.array(t)){for(var r=[],o=0,s=t.length;o<s;o++)r.push(this.get(t[o]));return r}throw(0,a.makeError)("Baobab.Cursor.project: wrong projection.",{projection:t})},e.prototype.startRecording=function(t){if((t=t||1/0)<1)throw(0,a.makeError)("Baobab.Cursor.startRecording: invalid max records.",{value:t});return this.state.recording=!0,this.archive?this:(this._lazyBind(),this.archive=new a.Archive(t),this)},e.prototype.stopRecording=function(){return this.state.recording=!1,this},e.prototype.undo=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(!this.state.recording)throw new Error("Baobab.Cursor.undo: cursor is not recording.");var e=this.archive.back(t);if(!e)throw Error("Baobab.Cursor.undo: cannot find a relevant record.");return this.state.undoing=!0,this.set(e),this},e.prototype.hasHistory=function(){return!(!this.archive||!this.archive.get().length)},e.prototype.getHistory=function(){return this.archive?this.archive.get():[]},e.prototype.clearHistory=function(){return this.archive&&this.archive.clear(),this},e.prototype.release=function(){this._dynamicPath&&this.tree.off("write",this._writeHandler),this.tree.off("update",this._updateHandler),this.hash&&delete this.tree._cursors[this.hash],delete this.tree,delete this.path,delete this.solvedPath,delete this.archive,this.kill(),this.state.killed=!0},e.prototype.toJSON=function(){return this.serialize()},e.prototype.toString=function(){return this._identity},e}(r.default);n.default=u,"function"==typeof Symbol&&void 0!==Symbol.iterator&&(u.prototype[Symbol.iterator]=function(){var t=this._get().data;if(!i.default.array(t))throw Error("baobab.Cursor.@@iterate: cannot iterate a non-list type.");var e=0,n=this,r=t.length;return{next:function(){return e<r?{value:n.select(e++)}:{done:!0}}}});var h={unset:!0,pop:!0,shift:!0};function f(t,e){u.prototype[t]=function(n,r){if(arguments.length>2)throw(0,a.makeError)("Baobab.Cursor."+t+": too many arguments.");if(1!==arguments.length||h[t]||(r=n,n=[]),n=(0,a.coercePath)(n),!i.default.path(n))throw(0,a.makeError)("Baobab.Cursor."+t+": invalid path.",{path:n});if(e&&!e(r))throw(0,a.makeError)("Baobab.Cursor."+t+": invalid value.",{path:n,value:r});if(!this.solvedPath)throw(0,a.makeError)("Baobab.Cursor."+t+": the dynamic path of the cursor cannot be solved.",{path:this.path});var o=this.solvedPath.concat(n);return this.tree.update(o,{type:t,value:r})}}f("set"),f("unset"),f("apply",i.default.function),f("push"),f("concat",i.default.array),f("unshift"),f("pop"),f("shift"),f("splice",i.default.splicer),f("merge",i.default.object),f("deepMerge",i.default.object)},{"./helpers":4,"./monkey":5,"./type":6,emmett:1}],4:[function(t,e,n){(function(e){"use strict";n.__esModule=!0,n.uniqid=n.deepMerge=n.shallowMerge=n.deepFreeze=n.freeze=n.deepClone=n.shallowClone=n.Archive=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};n.arrayFrom=function(t){return h(t)},n.before=function(t,e){return function(){t.apply(null,arguments),e.apply(null,arguments)}},n.coercePath=function(t){return t||0===t||""===t?t:[]},n.getIn=function(t,e){if(!e)return b;var n=[],o=!0,i=t,a=void 0,l=void 0,h=void 0;for(l=0,h=e.length;l<h;l++){if(!i)return{data:void 0,solvedPath:n.concat(e.slice(l)),exists:!1};if("function"==typeof e[l]){if(!s.default.array(i))return b;if(!~(a=u(i,e[l])))return b;n.push(a),i=i[a]}else if("object"===r(e[l])){if(!s.default.array(i))return b;if(!~(a=u(i,function(t){return d(t,e[l])})))return b;n.push(a),i=i[a]}else n.push(e[l]),o="object"===(void 0===i?"undefined":r(i))&&e[l]in i,i=i[e[l]]}return{data:i,solvedPath:n,exists:o}},n.makeError=function(t,e){var n=new Error(t);for(var r in e)n[r]=e[r];return n},n.hashPath=function(t){return"λ"+t.map(function(t){return s.default.function(t)||s.default.object(t)?"#"+P()+"#":t}).join("λ")},n.solveRelativePath=function(t,e){var n=[];e=[].concat(e);for(var r=0,o=e.length;r<o;r++){var i=e[r];"."===i?r||(n=t.slice(0)):".."===i?n=(r?n:t).slice(0,-1):n.push(i)}return n},n.solveUpdate=function(t,e){var n=void 0,r=void 0,o=void 0,i=void 0,a=void 0,s=void 0,l=void 0,u=void 0;for(n=0,i=t.length;n<i;n++){if(!(l=t[n]).length)return!0;for(r=0,a=e.length;r<a;r++){if(!(u=e[r])||!u.length)return!0;for(o=0,s=u.length;o<s&&u[o]==l[o];o++)if(o+1===s||o+1===l.length)return!0}}return!1},n.splice=function(t,e,n){for(var r=arguments.length,o=Array(r>3?r-3:0),i=3;i<r;i++)o[i-3]=arguments[i];if(void 0===n&&2===arguments.length)n=t.length-e;else if(null==n)n=0;else if(isNaN(+n))throw new Error("argument nb "+n+" can not be parsed into a number!");n=Math.max(0,n),s.default.function(e)&&(e=u(t,e));s.default.object(e)&&(e=u(t,function(t){return d(t,e)}));return e>=0?t.slice(0,e).concat(o).concat(t.slice(e+n)):t.slice(0,t.length+e).concat(o).concat(t.slice(t.length+e+n))};var o,i=t("./monkey"),a=t("./type"),s=(o=a)&&o.__esModule?o:{default:o};var l={}.hasOwnProperty;function u(t,e){var n,r=void 0;for(r=0,n=t.length;r<n;r++)if(e(t[r]))return r;return-1}function h(t){var e,n=new Array(t.length),r=void 0;for(r=0,e=t.length;r<e;r++)n[r]=t[r];return n}n.Archive=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.size=e,this.records=[]}return t.prototype.get=function(){return this.records},t.prototype.add=function(t){return this.records.unshift(t),this.records.length>this.size&&(this.records.length=this.size),this},t.prototype.clear=function(){return this.records=[],this},t.prototype.back=function(t){var e=this.records[t-1];return e&&(this.records=this.records.slice(t)),e},t}();function f(t,n){if(!n||"object"!==(void 0===n?"undefined":r(n))||n instanceof Error||n instanceof i.MonkeyDefinition||n instanceof i.Monkey||"ArrayBuffer"in e&&n instanceof ArrayBuffer)return n;if(s.default.array(n)){if(t){for(var o=new Array(n.length),a=0,l=n.length;a<l;a++)o[a]=f(!0,n[a]);return o}return h(n)}if(n instanceof Date)return new Date(n.getTime());if(n instanceof RegExp)return c=(u=n).source,p="",u.global&&(p+="g"),u.multiline&&(p+="m"),u.ignoreCase&&(p+="i"),u.sticky&&(p+="y"),u.unicode&&(p+="u"),new RegExp(c,p);var u,c,p;if(s.default.object(n)){for(var d={},y=Object.getOwnPropertyNames(n),v=0,m=y.length;v<m;v++){var b=y[v],g=Object.getOwnPropertyDescriptor(n,b);!0===g.enumerable?g.get&&g.get.isLazyGetter?Object.defineProperty(d,b,{get:g.get,enumerable:!0,configurable:!0}):d[b]=t?f(!0,n[b]):n[b]:!1===g.enumerable&&Object.defineProperty(d,b,{value:t?f(!0,g.value):g.value,enumerable:!1,writable:!0,configurable:!0})}return d}return n}var c=f.bind(null,!1),p=f.bind(null,!0);function d(t,e){var n=!0,r=void 0;if(!t)return!1;for(r in e)if(s.default.object(e[r]))n=n&&d(t[r],e[r]);else if(s.default.array(e[r]))n=n&&!!~e[r].indexOf(t[r]);else if(t[r]!==e[r])return!1;return n}function y(t,e){if(!("object"!==(void 0===e?"undefined":r(e))||null===e||e instanceof i.Monkey)&&(Object.freeze(e),t))if(Array.isArray(e)){var n,o=void 0;for(o=0,n=e.length;o<n;o++)m(e[o])}else{var a=void 0,u=void 0;for(u in e)s.default.lazyGetter(e,u)||(a=e[u])&&l.call(e,u)&&"object"===(void 0===a?"undefined":r(a))&&!Object.isFrozen(a)&&m(a)}}n.shallowClone=c,n.deepClone=p;var v=y.bind(null,!1),m=y.bind(null,!0);n.freeze=v,n.deepFreeze=m;var b={data:void 0,solvedPath:null,exists:!1};function g(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var o,a=n[0],l=void 0,u=void 0,h=void 0;for(u=1,o=n.length;u<o;u++)for(h in l=n[u])!t||!s.default.object(l[h])||l[h]instanceof i.Monkey?a[h]=l[h]:a[h]=g(!0,a[h]||{},l[h]);return a}var _=g.bind(null,!1),w=g.bind(null,!0);n.shallowMerge=_,n.deepMerge=w;var k,P=(k=0,function(){return k++});n.uniqid=P}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./monkey":5,"./type":6}],5:[function(t,e,n){"use strict";n.__esModule=!0,n.Monkey=n.MonkeyDefinition=void 0;var r=a(t("./type")),o=a(t("./update")),i=t("./helpers");function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.MonkeyDefinition=function t(e){var n=this;s(this,t);var o=r.default.monkeyDefinition(e);if(!o)throw(0,i.makeError)("Baobab.monkey: invalid definition.",{definition:e});if(this.type=o,"object"===this.type)this.getter=e.get,this.projection=e.cursors||{},this.paths=Object.keys(this.projection).map(function(t){return n.projection[t]}),this.options=e.options||{};else{var a=1,l={};r.default.object(e[e.length-1])&&(a++,l=e[e.length-1]),this.getter=e[e.length-a],this.projection=e.slice(0,-a),this.paths=this.projection,this.options=l}this.paths=this.paths.map(function(t){return[].concat(t)}),this.hasDynamicPaths=this.paths.some(r.default.dynamicPath)},n.Monkey=function(){function t(e,n,r){var o=this;s(this,t),this.tree=e,this.path=n,this.definition=r;var a=r.projection,l=i.solveRelativePath.bind(null,n.slice(0,-1));"object"===r.type?(this.projection=Object.keys(a).reduce(function(t,e){return t[e]=l(a[e]),t},{}),this.depPaths=Object.keys(this.projection).map(function(t){return o.projection[t]})):(this.projection=a.map(l),this.depPaths=this.projection),this.state={killed:!1},this.writeListener=function(t){var e=t.data.path;o.state.killed||(0,i.solveUpdate)([e],o.relatedPaths())&&o.update()},this.recursiveListener=function(t){var e=t.data,n=e.monkey,r=e.path;o.state.killed||o!==n&&(0,i.solveUpdate)([r],o.relatedPaths(!1))&&o.update()},this.tree.on("write",this.writeListener),this.tree.on("_monkey",this.recursiveListener),this.update()}return t.prototype.relatedPaths=function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=void 0;return n=this.definition.hasDynamicPaths?this.depPaths.map(function(e){return(0,i.getIn)(t.tree._data,e).solvedPath}):this.depPaths,e&&this.depPaths.some(function(e){return!!r.default.monkeyPath(t.tree._monkeys,e)})?n.reduce(function(e,n){var o=r.default.monkeyPath(t.tree._monkeys,n);if(!o)return e.concat([n]);var a=(0,i.getIn)(t.tree._monkeys,o).data;return e.concat(a.relatedPaths())},[]):n},t.prototype.update=function(){var t,e,n,r,a,s=this,l=this.tree.project(this.projection),u=(t=this.tree,e=this.definition,n=l,r=null,a=!1,function(){if(!a){r=e.getter.apply(t,"object"===e.type?[n]:n),t.options.immutable&&!1!==e.options.immutable&&(0,i.deepFreeze)(r);var o=(0,i.hashPath)(s.path);t._affectedPathsIndex[o]=!0,a=!0}return r});if(u.isLazyGetter=!0,this.tree.options.lazyMonkeys)this.tree._data=(0,o.default)(this.tree._data,this.path,{type:"monkey",value:u},this.tree.options).data;else{var h=(0,o.default)(this.tree._data,this.path,{type:"set",value:u(),options:{mutableLeaf:!this.definition.options.immutable}},this.tree.options);"data"in h&&(this.tree._data=h.data)}return this.tree.emit("_monkey",{monkey:this,path:this.path}),this},t.prototype.release=function(){this.tree.off("write",this.writeListener),this.tree.off("_monkey",this.recursiveListener),this.state.killed=!0,delete this.projection,delete this.depPaths,delete this.tree},t}()},{"./helpers":4,"./type":6,"./update":7}],6:[function(t,e,n){"use strict";n.__esModule=!0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=t("./monkey"),i={};function a(t,e){return e.some(function(e){return i[e](t)})}i.array=function(t){return Array.isArray(t)},i.object=function(t){return t&&"object"===(void 0===t?"undefined":r(t))&&!Array.isArray(t)&&!(t instanceof Date)&&!(t instanceof RegExp)&&!("function"==typeof Map&&t instanceof Map)&&!("function"==typeof Set&&t instanceof Set)},i.string=function(t){return"string"==typeof t},i.number=function(t){return"number"==typeof t},i.function=function(t){return"function"==typeof t},i.primitive=function(t){return t!==Object(t)},i.splicer=function(t){return!(!i.array(t)||t.length<1)&&(!(t.length>1&&isNaN(+t[1]))&&a(t[0],["number","function","object"]))};var s=["string","number","function","object"];i.path=function(t){return!(!t&&0!==t&&""!==t)&&[].concat(t).every(function(t){return a(t,s)})},i.dynamicPath=function(t){return t.some(function(t){return i.function(t)||i.object(t)})},i.monkeyPath=function(t,e){var n,i=[],a=t,s=void 0;for(s=0,n=e.length;s<n;s++){if(i.push(e[s]),"object"!==(void 0===a?"undefined":r(a)))return null;if((a=a[e[s]])instanceof o.Monkey)return i}return null},i.lazyGetter=function(t,e){var n=Object.getOwnPropertyDescriptor(t,e);return n&&n.get&&!0===n.get.isLazyGetter},i.monkeyDefinition=function(t){if(i.object(t))return i.function(t.get)&&(!t.cursors||i.object(t.cursors)&&Object.keys(t.cursors).every(function(e){return i.path(t.cursors[e])}))?"object":null;if(i.array(t)){var e=1;return i.object(t[t.length-1])&&e++,i.function(t[t.length-e])&&t.slice(0,-e).every(function(t){return i.path(t)})?"array":null}return null},i.watcherMapping=function(t){return i.object(t)&&Object.keys(t).every(function(e){return i.path(t[e])})};var l=["set","apply","push","unshift","concat","pop","shift","deepMerge","merge","splice","unset"];i.operationType=function(t){return"string"==typeof t&&!!~l.indexOf(t)},n.default=i},{"./monkey":5}],7:[function(t,e,n){"use strict";n.__esModule=!0,n.default=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=n.type,l=n.value,u=n.options,h=void 0===u?{}:u,f={root:t},c=["root"].concat(e),p=[],d=f,y=void 0,v=void 0,m=void 0;for(y=0,v=c.length;y<v;y++){if(m=c[y],y>0&&p.push(m),y===v-1){if("set"===o){if(r.pure&&d[m]===l)return{node:d[m]};i.default.lazyGetter(d,m)?Object.defineProperty(d,m,{value:l,enumerable:!0,configurable:!0}):r.persistent&&!h.mutableLeaf?d[m]=(0,a.shallowClone)(l):d[m]=l}else if("monkey"===o)Object.defineProperty(d,m,{get:l,enumerable:!0,configurable:!0});else if("apply"===o){var b=l(d[m]);if(r.pure&&d[m]===b)return{node:d[m]};i.default.lazyGetter(d,m)?Object.defineProperty(d,m,{value:b,enumerable:!0,configurable:!0}):r.persistent?d[m]=(0,a.shallowClone)(b):d[m]=b}else if("push"===o){if(!i.default.array(d[m]))throw s("push","array",p);r.persistent?d[m]=d[m].concat([l]):d[m].push(l)}else if("unshift"===o){if(!i.default.array(d[m]))throw s("unshift","array",p);r.persistent?d[m]=[l].concat(d[m]):d[m].unshift(l)}else if("concat"===o){if(!i.default.array(d[m]))throw s("concat","array",p);r.persistent?d[m]=d[m].concat(l):d[m].push.apply(d[m],l)}else if("splice"===o){if(!i.default.array(d[m]))throw s("splice","array",p);r.persistent?d[m]=a.splice.apply(null,[d[m]].concat(l)):d[m].splice.apply(d[m],l)}else if("pop"===o){if(!i.default.array(d[m]))throw s("pop","array",p);r.persistent?d[m]=(0,a.splice)(d[m],-1,1):d[m].pop()}else if("shift"===o){if(!i.default.array(d[m]))throw s("shift","array",p);r.persistent?d[m]=(0,a.splice)(d[m],0,1):d[m].shift()}else if("unset"===o)i.default.object(d)?delete d[m]:i.default.array(d)&&d.splice(m,1);else if("merge"===o){if(!i.default.object(d[m]))throw s("merge","object",p);r.persistent?d[m]=(0,a.shallowMerge)({},d[m],l):d[m]=(0,a.shallowMerge)(d[m],l)}else if("deepMerge"===o){if(!i.default.object(d[m]))throw s("deepMerge","object",p);r.persistent?d[m]=(0,a.deepMerge)({},d[m],l):d[m]=(0,a.deepMerge)(d[m],l)}r.immutable&&!h.mutableLeaf&&(0,a.deepFreeze)(d);break}i.default.primitive(d[m])?d[m]={}:r.persistent&&(d[m]=(0,a.shallowClone)(d[m])),r.immutable&&v>0&&(0,a.freeze)(d),d=d[m]}return i.default.lazyGetter(d,m)?{data:f.root}:{data:f.root,node:d[m]}};var r,o=t("./type"),i=(r=o)&&r.__esModule?r:{default:r},a=t("./helpers");function s(t,e,n){return(0,a.makeError)('Baobab.update: cannot apply the "'+t+'" on a non '+e+" (path: /"+n.join("/")+").",{path:n})}},{"./helpers":4,"./type":6}],8:[function(t,e,n){"use strict";n.__esModule=!0;var r=s(t("emmett")),o=s(t("./cursor")),i=s(t("./type")),a=t("./helpers");function s(t){return t&&t.__esModule?t:{default:t}}var l=function(t){function e(n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,t.call(this));return o.tree=n,o.mapping=null,o.state={killed:!1},o.refresh(r),o.handler=function(t){if(!o.state.killed){var e=o.getWatchedPaths();return(0,a.solveUpdate)(t.data.paths,e)?o.emit("update"):void 0}},o.tree.on("update",o.handler),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.getWatchedPaths=function(){var t=this;return Object.keys(this.mapping).map(function(e){var n=t.mapping[e];return n instanceof o.default?n.solvedPath:t.mapping[e]}).reduce(function(e,n){if(n=[].concat(n),i.default.dynamicPath(n)&&(n=(0,a.getIn)(t.tree._data,n).solvedPath),!n)return e;var r=i.default.monkeyPath(t.tree._monkeys,n);return r?e.concat((0,a.getIn)(t.tree._monkeys,r).data.relatedPaths()):e.concat([n])},[])},e.prototype.getCursors=function(){var t=this,e={};return Object.keys(this.mapping).forEach(function(n){var r=t.mapping[n];r instanceof o.default?e[n]=r:e[n]=t.tree.select(r)}),e},e.prototype.refresh=function(t){if(!i.default.watcherMapping(t))throw(0,a.makeError)("Baobab.watch: invalid mapping.",{mapping:t});this.mapping=t;var e={};for(var n in t)e[n]=t[n]instanceof o.default?t[n].path:t[n];this.get=this.tree.project.bind(this.tree,e)},e.prototype.release=function(){this.tree.off("update",this.handler),this.state.killed=!0,this.kill()},e}(r.default);n.default=l},{"./cursor":3,"./helpers":4,"./type":6,emmett:1}]},{},[2])(2)});